import{a5 as O,o as p,c as v,w as t,b as s,H as x,M as j,N as w,e as h,d,t as m,ak as q,k,n as R,al as H,aa as V,F as U,ab as A,D as P,l as _,E as I,Q as W,f as D,W as E,B as S,p as b,X as N,_ as C,a6 as T,I as B,ag as Q,U as M,ad as K,A as X,an as G,a8 as Y,V as Z}from"./index-427e6df5.js";import{A as $}from"./AstrBotConfig-8422f4c3.js";import{W as ee}from"./WaitingForRestart-c0cfd70f.js";import{C as te}from"./ConsoleDisplayer-b4e5ebdb.js";import{I as se}from"./ItemCard-7d8df7ff.js";import{_ as F}from"./_plugin-vue_export-helper-c27b6911.js";import"./index-c4200cc5.js";import"./KnowledgeBaseSelector-73bc8187.js";import"./common-74ca9dd8.js";function J(e){return{openai:"https://registry.npmmirror.com/@lobehub/icons-static-svg/latest/files/icons/openai.svg",azure:"https://registry.npmmirror.com/@lobehub/icons-static-svg/latest/files/icons/azure.svg",xai:"https://registry.npmmirror.com/@lobehub/icons-static-svg/latest/files/icons/xai.svg",anthropic:"https://registry.npmmirror.com/@lobehub/icons-static-svg/latest/files/icons/anthropic.svg",ollama:"https://registry.npmmirror.com/@lobehub/icons-static-svg/latest/files/icons/ollama.svg",google:"https://registry.npmmirror.com/@lobehub/icons-static-svg/latest/files/icons/gemini-color.svg",deepseek:"https://registry.npmmirror.com/@lobehub/icons-static-svg/latest/files/icons/deepseek.svg",modelscope:"https://registry.npmmirror.com/@lobehub/icons-static-svg/latest/files/icons/modelscope.svg",zhipu:"https://registry.npmmirror.com/@lobehub/icons-static-svg/latest/files/icons/zhipu.svg",siliconflow:"https://registry.npmmirror.com/@lobehub/icons-static-svg/latest/files/icons/siliconcloud.svg",moonshot:"https://registry.npmmirror.com/@lobehub/icons-static-svg/latest/files/icons/kimi.svg",ppio:"https://registry.npmmirror.com/@lobehub/icons-static-svg/latest/files/icons/ppio.svg",dify:"https://registry.npmmirror.com/@lobehub/icons-static-svg/latest/files/icons/dify-color.svg",coze:"https://registry.npmmirror.com/@lobehub/icons-static-svg/1.66.0/files/icons/coze.svg",dashscope:"https://registry.npmmirror.com/@lobehub/icons-static-svg/latest/files/icons/alibabacloud-color.svg",fastgpt:"https://registry.npmmirror.com/@lobehub/icons-static-svg/latest/files/icons/fastgpt-color.svg",lm_studio:"https://registry.npmmirror.com/@lobehub/icons-static-svg/latest/files/icons/lmstudio.svg",fishaudio:"https://registry.npmmirror.com/@lobehub/icons-static-svg/latest/files/icons/fishaudio.svg",minimax:"https://registry.npmmirror.com/@lobehub/icons-static-svg/latest/files/icons/minimax.svg","302ai":"https://registry.npmmirror.com/@lobehub/icons-static-svg/1.53.0/files/icons/ai302-color.svg",microsoft:"https://registry.npmmirror.com/@lobehub/icons-static-svg/latest/files/icons/microsoft.svg",vllm:"https://registry.npmmirror.com/@lobehub/icons-static-svg/latest/files/icons/vllm.svg"}[e]||""}function ie(e,i,n){return i=="OpenAI"?n("providers.description.openai",{type:e.type}):i=="vLLM Rerank"?n("providers.description.vllm_rerank",{type:e.type}):n("providers.description.default",{type:e.type})}const oe={name:"AddNewProvider",props:{show:{type:Boolean,default:!1},metadata:{type:Object,default:()=>({})}},emits:["update:show","select-template"],setup(){const{tm:e}=O("features/provider");return{tm:e}},data(){return{activeProviderTab:"chat_completion"}},computed:{showDialog:{get(){return this.show},set(e){this.$emit("update:show",e)}},messages(){return{tabTypes:{chat_completion:this.tm("providers.tabs.chatCompletion"),speech_to_text:this.tm("providers.tabs.speechToText"),text_to_speech:this.tm("providers.tabs.textToSpeech"),embedding:this.tm("providers.tabs.embedding"),rerank:this.tm("providers.tabs.rerank")}}}},methods:{closeDialog(){this.showDialog=!1},getTemplatesByType(e){var a,o,l;const i=((l=(o=(a=this.metadata.provider_group)==null?void 0:a.metadata)==null?void 0:o.provider)==null?void 0:l.config_template)||{},n={};for(const[c,g]of Object.entries(i))g.provider_type===e&&(n[c]=g);return n},getProviderIcon:J,getTabTypeName(e){return this.messages.tabTypes[e]||e},getProviderDescription(e,i){return ie(e,i,this.tm)},selectProviderTemplate(e){this.$emit("select-template",e),this.closeDialog()}}},ae={class:"provider-card-content"},re={class:"provider-card-text"},le={class:"provider-card-logo"},de=["src"],ne={key:1,class:"provider-logo-fallback"};function ce(e,i,n,a,o,l){return p(),v(N,{modelValue:l.showDialog,"onUpdate:modelValue":i[2]||(i[2]=c=>l.showDialog=c),"max-width":"1100px","min-height":"95%"},{default:t(()=>[s(P,{title:a.tm("dialogs.addProvider.title")},{default:t(()=>[s(x,{style:{"overflow-y":"auto"}},{default:t(()=>[s(j,{modelValue:o.activeProviderTab,"onUpdate:modelValue":i[0]||(i[0]=c=>o.activeProviderTab=c),grow:""},{default:t(()=>[s(w,{value:"chat_completion",class:"font-weight-medium px-3"},{default:t(()=>[s(h,{start:""},{default:t(()=>[d("mdi-message-text")]),_:1}),d(" "+m(a.tm("dialogs.addProvider.tabs.basic")),1)]),_:1}),s(w,{value:"speech_to_text",class:"font-weight-medium px-3"},{default:t(()=>[s(h,{start:""},{default:t(()=>[d("mdi-microphone-message")]),_:1}),d(" "+m(a.tm("dialogs.addProvider.tabs.speechToText")),1)]),_:1}),s(w,{value:"text_to_speech",class:"font-weight-medium px-3"},{default:t(()=>[s(h,{start:""},{default:t(()=>[d("mdi-volume-high")]),_:1}),d(" "+m(a.tm("dialogs.addProvider.tabs.textToSpeech")),1)]),_:1}),s(w,{value:"embedding",class:"font-weight-medium px-3"},{default:t(()=>[s(h,{start:""},{default:t(()=>[d("mdi-code-json")]),_:1}),d(" "+m(a.tm("dialogs.addProvider.tabs.embedding")),1)]),_:1}),s(w,{value:"rerank",class:"font-weight-medium px-3"},{default:t(()=>[s(h,{start:""},{default:t(()=>[d("mdi-compare-vertical")]),_:1}),d(" "+m(a.tm("dialogs.addProvider.tabs.rerank")),1)]),_:1})]),_:1},8,["modelValue"]),s(q,{modelValue:o.activeProviderTab,"onUpdate:modelValue":i[1]||(i[1]=c=>o.activeProviderTab=c),class:"mt-4"},{default:t(()=>[(p(),k(U,null,R(["chat_completion","speech_to_text","text_to_speech","embedding","rerank"],c=>s(H,{key:c,value:c},{default:t(()=>[s(V,{class:"mt-1"},{default:t(()=>[(p(!0),k(U,null,R(l.getTemplatesByType(c),(g,f)=>(p(),v(A,{key:f,cols:"12",sm:"6",md:"4"},{default:t(()=>[s(P,{variant:"outlined",hover:"",class:"provider-card",onClick:u=>l.selectProviderTemplate(f)},{default:t(()=>[_("div",ae,[_("div",re,[s(I,{class:"provider-card-title"},{default:t(()=>[d("接入 "+m(f),1)]),_:2},1024),s(x,{class:"text-caption text-medium-emphasis provider-card-description"},{default:t(()=>[d(m(l.getProviderDescription(g,f)),1)]),_:2},1024)]),_("div",le,[l.getProviderIcon(g.provider)?(p(),k("img",{key:0,src:l.getProviderIcon(g.provider),class:"provider-logo-img"},null,8,de)):(p(),k("div",ne,m(f[0].toUpperCase()),1))])])]),_:2},1032,["onClick"])]),_:2},1024))),128)),Object.keys(l.getTemplatesByType(c)).length===0?(p(),v(A,{key:0,cols:"12"},{default:t(()=>[s(W,{type:"info",variant:"tonal"},{default:t(()=>[d(m(a.tm("dialogs.addProvider.noTemplates",{type:l.getTabTypeName(c)})),1)]),_:2},1024)]),_:2},1024)):D("",!0)]),_:2},1024)]),_:2},1032,["value"])),64))]),_:1},8,["modelValue"])]),_:1}),s(E,null,{default:t(()=>[s(S),s(b,{text:"",onClick:l.closeDialog},{default:t(()=>[d(m(a.tm("dialogs.config.cancel")),1)]),_:1},8,["onClick"])]),_:1})]),_:1},8,["title"])]),_:1},8,["modelValue"])}const me=F(oe,[["render",ce],["__scopeId","data-v-936a7bc7"]]);const fe={name:"ProviderPage",components:{AstrBotConfig:$,WaitingForRestart:ee,ConsoleDisplayer:te,ItemCard:se,AddNewProvider:me},setup(){const{tm:e}=O("features/provider");return{tm:e}},data(){return{config_data:{},fetched:!1,metadata:{},showProviderCfg:!1,showIdConflictDialog:!1,conflictId:"",idConflictResolve:null,showKeyConfirm:!1,keyConfirmResolve:null,newSelectedProviderName:"",newSelectedProviderConfig:{},updatingMode:!1,loading:!1,save_message_snack:!1,save_message:"",save_message_success:"success",showConsole:!1,showStatus:!1,providerStatuses:[],testingProviders:[],showAddProviderDialog:!1,activeProviderTypeTab:"all",oldVersionProviderTypeMapping:{openai_chat_completion:"chat_completion",anthropic_chat_completion:"chat_completion",googlegenai_chat_completion:"chat_completion",zhipu_chat_completion:"chat_completion",dify:"chat_completion",coze:"chat_completion",dashscope:"chat_completion",openai_whisper_api:"speech_to_text",openai_whisper_selfhost:"speech_to_text",sensevoice_stt_selfhost:"speech_to_text",openai_tts_api:"text_to_speech",edge_tts:"text_to_speech",gsvi_tts_api:"text_to_speech",fishaudio_tts_api:"text_to_speech",dashscope_tts:"text_to_speech",azure_tts:"text_to_speech",minimax_tts_api:"text_to_speech",volcengine_tts:"text_to_speech"}}},watch:{showIdConflictDialog(e){!e&&this.idConflictResolve&&(this.idConflictResolve(!1),this.idConflictResolve=null)},showKeyConfirm(e){!e&&this.keyConfirmResolve&&(this.keyConfirmResolve(!1),this.keyConfirmResolve=null)}},computed:{messages(){return{emptyText:{all:this.tm("providers.empty.all"),typed:this.tm("providers.empty.typed")},tabTypes:{chat_completion:this.tm("providers.tabs.chatCompletion"),speech_to_text:this.tm("providers.tabs.speechToText"),text_to_speech:this.tm("providers.tabs.textToSpeech"),embedding:this.tm("providers.tabs.embedding"),rerank:this.tm("providers.tabs.rerank")},success:{update:this.tm("messages.success.update"),add:this.tm("messages.success.add"),delete:this.tm("messages.success.delete"),statusUpdate:this.tm("messages.success.statusUpdate")},error:{fetchStatus:this.tm("messages.error.fetchStatus"),testError:this.tm("messages.error.testError")},confirm:{delete:this.tm("messages.confirm.delete")},status:{available:this.tm("availability.available"),unavailable:this.tm("availability.unavailable"),pending:this.tm("availability.pending")},availability:{test:this.tm("availability.test")}}},filteredProviders(){return!this.config_data.provider||this.activeProviderTypeTab==="all"?this.config_data.provider||[]:this.config_data.provider.filter(e=>e.provider_type?e.provider_type===this.activeProviderTypeTab:this.oldVersionProviderTypeMapping[e.type]===this.activeProviderTypeTab)}},mounted(){this.getConfig()},methods:{getConfig(){C.get("/api/config/get").then(e=>{this.config_data=e.data.data.config,this.fetched=!0,this.metadata=e.data.data.metadata}).catch(e=>{var i,n;this.showError(((n=(i=e.response)==null?void 0:i.data)==null?void 0:n.message)||e.message)})},getProviderIcon:J,getEmptyText(){return this.activeProviderTypeTab==="all"?this.messages.emptyText.all:this.tm("providers.empty.typed",{type:this.getTabTypeName(this.activeProviderTypeTab)})},getTabTypeName(e){return this.messages.tabTypes[e]||e},selectProviderTemplate(e){var i,n,a;this.newSelectedProviderName=e,this.showProviderCfg=!0,this.updatingMode=!1,this.newSelectedProviderConfig=JSON.parse(JSON.stringify(((a=(n=(i=this.metadata.provider_group)==null?void 0:i.metadata)==null?void 0:n.provider)==null?void 0:a.config_template[e])||{}))},configExistingProvider(e){var o,l,c,g;this.newSelectedProviderName=e.id,this.newSelectedProviderConfig={};let i=((c=(l=(o=this.metadata.provider_group)==null?void 0:o.metadata)==null?void 0:l.provider)==null?void 0:c.config_template)||{},n={};for(let f in i)if(((g=i[f])==null?void 0:g.type)===e.type){n=i[f];break}const a=(f,u,y)=>{if(u&&typeof u=="object"&&!Array.isArray(u))for(let r in u)u.hasOwnProperty(r)&&(typeof u[r]=="object"&&u[r]!==null?f[r]=Array.isArray(u[r])?[...u[r]]:{...u[r]}:f[r]=u[r]);for(let r in y)typeof y[r]=="object"&&y[r]!==null?(r in f||(Array.isArray(y[r])?f[r]=[...y[r]]:f[r]={}),Array.isArray(y[r])||a(f[r],u&&u[r]?u[r]:{},y[r])):r in f||(f[r]=y[r])};n&&a(this.newSelectedProviderConfig,e,n),this.showProviderCfg=!0,this.updatingMode=!0},async newProvider(){var i,n,a;if("key"in this.newSelectedProviderConfig&&(!this.newSelectedProviderConfig.key||this.newSelectedProviderConfig.key.length===0)&&!await this.confirmEmptyKey())return;this.loading=!0;const e=this.updatingMode;try{if(e){const o=await C.post("/api/config/provider/update",{id:this.newSelectedProviderName,config:this.newSelectedProviderConfig});this.showSuccess(o.data.message||"更新成功!")}else{if(((i=this.config_data.provider)==null?void 0:i.find(c=>c.id===this.newSelectedProviderConfig.id))&&!await this.confirmIdConflict(this.newSelectedProviderConfig.id)){this.loading=!1;return}const l=await C.post("/api/config/provider/new",this.newSelectedProviderConfig);this.showSuccess(l.data.message||"添加成功!")}this.showProviderCfg=!1,this.getConfig()}catch(o){this.showError(((a=(n=o.response)==null?void 0:n.data)==null?void 0:a.message)||o.message)}finally{this.loading=!1,e&&(this.updatingMode=!1)}},async copyProvider(e){var a,o;console.log("copyProvider triggered for:",e);const i=JSON.parse(JSON.stringify(e)),n=l=>{let c=`${l}_copy`,g=1;const f=this.config_data.provider.map(u=>u.id);for(;f.includes(c);)c=`${l}_copy_${g}`,g++;return c};i.id=n(e.id),i.enable=!1,this.loading=!0;try{const l=await C.post("/api/config/provider/new",i);this.showSuccess(l.data.message||`成功复制并创建了 ${i.id}`),this.getConfig()}catch(l){this.showError(((o=(a=l.response)==null?void 0:a.data)==null?void 0:o.message)||l.message)}finally{this.loading=!1}},deleteProvider(e){confirm(this.tm("messages.confirm.delete",{id:e.id}))&&C.post("/api/config/provider/delete",{id:e.id}).then(i=>{this.getConfig(),this.showSuccess(i.data.message||this.messages.success.delete)}).catch(i=>{var n,a;this.showError(((a=(n=i.response)==null?void 0:n.data)==null?void 0:a.message)||i.message)})},providerStatusChange(e){e.enable=!e.enable,C.post("/api/config/provider/update",{id:e.id,config:e}).then(i=>{this.getConfig(),this.showSuccess(i.data.message||this.messages.success.statusUpdate)}).catch(i=>{var n,a;e.enable=!e.enable,this.showError(((a=(n=i.response)==null?void 0:n.data)==null?void 0:a.message)||i.message)})},showSuccess(e){this.save_message=e,this.save_message_success="success",this.save_message_snack=!0},showError(e){this.save_message=e,this.save_message_success="error",this.save_message_snack=!0},async fetchProviderStatus(){if(this.testingProviders.length>0)return;this.showStatus=!0;const e=this.config_data.provider.filter(n=>n.enable);if(e.length===0)return;this.providerStatuses=e.map(n=>(this.testingProviders.push(n.id),{id:n.id,name:n.id,status:"pending",error:null}));const i=e.map(n=>C.get(`/api/config/provider/check_one?id=${n.id}`).then(a=>{var o;if(a.data&&a.data.status==="ok"){const l=this.providerStatuses.findIndex(c=>c.id===n.id);l!==-1&&this.providerStatuses.splice(l,1,a.data.data)}else throw new Error(((o=a.data)==null?void 0:o.message)||`Failed to check status for ${n.id}`)}).catch(a=>{var c,g;const o=((g=(c=a.response)==null?void 0:c.data)==null?void 0:g.message)||a.message||"Unknown error",l=this.providerStatuses.findIndex(f=>f.id===n.id);if(l!==-1){const f={...this.providerStatuses[l],status:"unavailable",error:o};this.providerStatuses.splice(l,1,f)}return Promise.reject(o)}));try{await Promise.allSettled(i)}finally{this.testingProviders=[]}},isProviderTesting(e){return this.testingProviders.includes(e)},async testSingleProvider(e){var a,o,l;if(this.isProviderTesting(e.id))return;this.testingProviders.push(e.id),this.showStatus=!0;const i=this.providerStatuses.findIndex(c=>c.id===e.id),n={id:e.id,name:e.id,status:"pending",error:null};i!==-1?this.providerStatuses.splice(i,1,n):this.providerStatuses.unshift(n);try{if(!e.enable)throw new Error("该提供商未被用户启用");const c=await C.get(`/api/config/provider/check_one?id=${e.id}`);if(c.data&&c.data.status==="ok"){const g=this.providerStatuses.findIndex(f=>f.id===e.id);g!==-1&&this.providerStatuses.splice(g,1,c.data.data)}else throw new Error(((a=c.data)==null?void 0:a.message)||`Failed to check status for ${e.id}`)}catch(c){const g=((l=(o=c.response)==null?void 0:o.data)==null?void 0:l.message)||c.message||"Unknown error",f=this.providerStatuses.findIndex(y=>y.id===e.id),u={id:e.id,name:e.id,status:"unavailable",error:g};f!==-1&&this.providerStatuses.splice(f,1,u)}finally{const c=this.testingProviders.indexOf(e.id);c>-1&&this.testingProviders.splice(c,1)}},confirmEmptyKey(){return this.showKeyConfirm=!0,new Promise(e=>{this.keyConfirmResolve=e})},handleKeyConfirm(e){this.keyConfirmResolve&&this.keyConfirmResolve(e),this.showKeyConfirm=!1},confirmIdConflict(e){return this.conflictId=e,this.showIdConflictDialog=!0,new Promise(i=>{this.idConflictResolve=i})},handleIdConflictConfirm(e){this.idConflictResolve&&this.idConflictResolve(e),this.showIdConflictDialog=!1},getStatusColor(e){switch(e){case"available":return"success";case"unavailable":return"error";case"pending":return"grey";default:return"default"}},getStatusText(e){return this.messages.status[e]||e}}},ge={class:"provider-page"},he={class:"text-h1 font-weight-bold mb-2"},pe={class:"text-subtitle-1 text-medium-emphasis mb-4"},ue={class:"text-grey mt-4"},ve={class:"text-h4"},_e={class:"font-weight-bold"},ye={class:"font-weight-bold"},be={class:"text-h4"};function we(e,i,n,a,o,l){const c=T("item-card"),g=T("ConsoleDisplayer"),f=T("AddNewProvider"),u=T("AstrBotConfig"),y=T("WaitingForRestart");return p(),k("div",ge,[s(B,{fluid:"",class:"pa-0"},{default:t(()=>[s(V,{class:"d-flex justify-space-between align-center px-4 py-3 pb-8"},{default:t(()=>[_("div",null,[_("h1",he,[s(h,{color:"black",class:"me-2"},{default:t(()=>[d("mdi-creation")]),_:1}),d(m(a.tm("title")),1)]),_("p",pe,m(a.tm("subtitle")),1)]),_("div",null,[s(b,{color:"primary","prepend-icon":"mdi-plus",variant:"tonal",onClick:i[0]||(i[0]=r=>o.showAddProviderDialog=!0),rounded:"xl",size:"x-large"},{default:t(()=>[d(m(a.tm("providers.addProvider")),1)]),_:1})])]),_:1}),_("div",null,[s(j,{modelValue:o.activeProviderTypeTab,"onUpdate:modelValue":i[1]||(i[1]=r=>o.activeProviderTypeTab=r),"bg-color":"transparent",class:"mb-4"},{default:t(()=>[s(w,{value:"all",class:"font-weight-medium px-3"},{default:t(()=>[s(h,{start:""},{default:t(()=>[d("mdi-filter-variant")]),_:1}),d(" "+m(a.tm("providers.tabs.all")),1)]),_:1}),s(w,{value:"chat_completion",class:"font-weight-medium px-3"},{default:t(()=>[s(h,{start:""},{default:t(()=>[d("mdi-message-text")]),_:1}),d(" "+m(a.tm("providers.tabs.chatCompletion")),1)]),_:1}),s(w,{value:"speech_to_text",class:"font-weight-medium px-3"},{default:t(()=>[s(h,{start:""},{default:t(()=>[d("mdi-microphone-message")]),_:1}),d(" "+m(a.tm("providers.tabs.speechToText")),1)]),_:1}),s(w,{value:"text_to_speech",class:"font-weight-medium px-3"},{default:t(()=>[s(h,{start:""},{default:t(()=>[d("mdi-volume-high")]),_:1}),d(" "+m(a.tm("providers.tabs.textToSpeech")),1)]),_:1}),s(w,{value:"embedding",class:"font-weight-medium px-3"},{default:t(()=>[s(h,{start:""},{default:t(()=>[d("mdi-code-json")]),_:1}),d(" "+m(a.tm("providers.tabs.embedding")),1)]),_:1}),s(w,{value:"rerank",class:"font-weight-medium px-3"},{default:t(()=>[s(h,{start:""},{default:t(()=>[d("mdi-compare-vertical")]),_:1}),d(" "+m(a.tm("providers.tabs.rerank")),1)]),_:1})]),_:1},8,["modelValue"]),l.filteredProviders.length===0?(p(),v(V,{key:0},{default:t(()=>[s(A,{cols:"12",class:"text-center pa-8"},{default:t(()=>[s(h,{size:"64",color:"grey-lighten-1"},{default:t(()=>[d("mdi-api-off")]),_:1}),_("p",ue,m(l.getEmptyText()),1)]),_:1})]),_:1})):(p(),v(V,{key:1},{default:t(()=>[(p(!0),k(U,null,R(l.filteredProviders,(r,L)=>(p(),v(A,{key:L,cols:"12",md:"6",lg:"4",xl:"3"},{default:t(()=>[s(c,{item:r,"title-field":"id","enabled-field":"enable",loading:l.isProviderTesting(r.id),onToggleEnabled:l.providerStatusChange,bglogo:l.getProviderIcon(r.provider),onDelete:l.deleteProvider,onEdit:l.configExistingProvider,onCopy:l.copyProvider,"show-copy-button":!0},{actions:t(({item:z})=>[s(b,{style:{"z-index":"100000"},variant:"tonal",color:"info",rounded:"xl",size:"small",loading:l.isProviderTesting(z.id),onClick:xe=>l.testSingleProvider(z)},{default:t(()=>[d(m(a.tm("availability.test")),1)]),_:2},1032,["loading","onClick"])]),details:t(({item:z})=>[]),_:2},1032,["item","loading","onToggleEnabled","bglogo","onDelete","onEdit","onCopy"])]),_:2},1024))),128))]),_:1}))]),s(P,{elevation:"0",class:"mt-4"},{default:t(()=>[s(I,{class:"d-flex align-center py-3 px-4"},{default:t(()=>[s(h,{class:"me-2"},{default:t(()=>[d("mdi-heart-pulse")]),_:1}),_("span",ve,m(a.tm("availability.title")),1),s(S),s(b,{color:"primary",variant:"tonal",loading:o.testingProviders.length>0,onClick:l.fetchProviderStatus},{default:t(()=>[s(h,{left:""},{default:t(()=>[d("mdi-refresh")]),_:1}),d(" "+m(a.tm("availability.refresh")),1)]),_:1},8,["loading","onClick"]),s(b,{variant:"text",color:"primary",onClick:i[2]||(i[2]=r=>o.showStatus=!o.showStatus),style:{"margin-left":"8px"}},{default:t(()=>[d(m(o.showStatus?a.tm("logs.collapse"):a.tm("logs.expand"))+" ",1),s(h,null,{default:t(()=>[d(m(o.showStatus?"mdi-chevron-up":"mdi-chevron-down"),1)]),_:1})]),_:1})]),_:1}),s(M),s(K,null,{default:t(()=>[o.showStatus?(p(),v(x,{key:0,class:"pa-0"},{default:t(()=>[s(x,{class:"px-4 py-3"},{default:t(()=>[o.providerStatuses.length===0?(p(),v(W,{key:0,type:"info",variant:"tonal"},{default:t(()=>[d(m(a.tm("availability.noData")),1)]),_:1})):(p(),v(B,{key:1,class:"pa-0"},{default:t(()=>[s(V,null,{default:t(()=>[(p(!0),k(U,null,R(o.providerStatuses,r=>(p(),v(A,{key:r.id,cols:"12",sm:"6",md:"4"},{default:t(()=>[s(P,{variant:"outlined",class:X(["status-card",`status-${r.status}`])},{default:t(()=>[s(G,null,{default:t(()=>[r.status==="available"?(p(),v(h,{key:0,color:"success",class:"me-2"},{default:t(()=>[d("mdi-check-circle")]),_:1})):r.status==="unavailable"?(p(),v(h,{key:1,color:"error",class:"me-2"},{default:t(()=>[d("mdi-alert-circle")]),_:1})):r.status==="pending"?(p(),v(Y,{key:2,indeterminate:"",color:"primary",size:"20",width:"2",class:"me-2"})):D("",!0),_("span",_e,m(r.id),1),s(Z,{color:l.getStatusColor(r.status),size:"small",class:"ml-2"},{default:t(()=>[d(m(l.getStatusText(r.status)),1)]),_:2},1032,["color"])]),_:2},1024),r.status==="unavailable"?(p(),v(x,{key:0,class:"text-caption text-medium-emphasis"},{default:t(()=>[_("span",ye,m(a.tm("availability.errorMessage"))+":",1),d(" "+m(r.error),1)]),_:2},1024)):D("",!0)]),_:2},1032,["class"])]),_:2},1024))),128))]),_:1})]),_:1}))]),_:1})]),_:1})):D("",!0)]),_:1})]),_:1}),s(P,{elevation:"0",class:"mt-4"},{default:t(()=>[s(I,{class:"d-flex align-center py-3 px-4"},{default:t(()=>[s(h,{class:"me-2"},{default:t(()=>[d("mdi-console-line")]),_:1}),_("span",be,m(a.tm("logs.title")),1),s(S),s(b,{variant:"text",color:"primary",onClick:i[3]||(i[3]=r=>o.showConsole=!o.showConsole)},{default:t(()=>[d(m(o.showConsole?a.tm("logs.collapse"):a.tm("logs.expand"))+" ",1),s(h,null,{default:t(()=>[d(m(o.showConsole?"mdi-chevron-up":"mdi-chevron-down"),1)]),_:1})]),_:1})]),_:1}),s(M),s(K,null,{default:t(()=>[o.showConsole?(p(),v(x,{key:0,class:"pa-0"},{default:t(()=>[s(g,{style:{"background-color":"#1e1e1e",height:"300px","border-radius":"0"}})]),_:1})):D("",!0)]),_:1})]),_:1})]),_:1}),s(f,{show:o.showAddProviderDialog,"onUpdate:show":i[4]||(i[4]=r=>o.showAddProviderDialog=r),metadata:o.metadata,onSelectTemplate:l.selectProviderTemplate},null,8,["show","metadata","onSelectTemplate"]),s(N,{modelValue:o.showProviderCfg,"onUpdate:modelValue":i[6]||(i[6]=r=>o.showProviderCfg=r),width:"900",persistent:""},{default:t(()=>[s(P,{title:o.updatingMode?a.tm("dialogs.config.editTitle"):a.tm("dialogs.config.addTitle")+` ${o.newSelectedProviderName} `+a.tm("dialogs.config.provider")},{default:t(()=>[s(x,{class:"py-4"},{default:t(()=>{var r;return[s(u,{iterable:o.newSelectedProviderConfig,metadata:(r=o.metadata.provider_group)==null?void 0:r.metadata,metadataKey:"provider","is-editing":o.updatingMode},null,8,["iterable","metadata","is-editing"])]}),_:1}),s(M),s(E,{class:"pa-4"},{default:t(()=>[s(S),s(b,{variant:"text",onClick:i[5]||(i[5]=r=>o.showProviderCfg=!1),disabled:o.loading},{default:t(()=>[d(m(a.tm("dialogs.config.cancel")),1)]),_:1},8,["disabled"]),s(b,{color:"primary",onClick:l.newProvider,loading:o.loading},{default:t(()=>[d(m(a.tm("dialogs.config.save")),1)]),_:1},8,["onClick","loading"])]),_:1})]),_:1},8,["title"])]),_:1},8,["modelValue"]),s(Q,{timeout:3e3,elevation:"24",color:o.save_message_success,modelValue:o.save_message_snack,"onUpdate:modelValue":i[7]||(i[7]=r=>o.save_message_snack=r),location:"top"},{default:t(()=>[d(m(o.save_message),1)]),_:1},8,["color","modelValue"]),s(y,{ref:"wfr"},null,512),s(N,{modelValue:o.showIdConflictDialog,"onUpdate:modelValue":i[9]||(i[9]=r=>o.showIdConflictDialog=r),"max-width":"450",persistent:""},{default:t(()=>[s(P,null,{default:t(()=>[s(I,{class:"text-h6 bg-warning d-flex align-center"},{default:t(()=>[s(h,{start:"",class:"me-2"},{default:t(()=>[d("mdi-alert-circle-outline")]),_:1}),d(" ID 冲突警告 ")]),_:1}),s(x,{class:"py-4 text-body-1 text-medium-emphasis"},{default:t(()=>[d(' 检测到 ID "'+m(o.conflictId)+'" 重复。请使用一个新的 ID。 ',1)]),_:1}),s(E,null,{default:t(()=>[s(S),s(b,{color:"grey",variant:"text",onClick:i[8]||(i[8]=r=>l.handleIdConflictConfirm(!1))},{default:t(()=>[d("好的")]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),s(N,{modelValue:o.showKeyConfirm,"onUpdate:modelValue":i[12]||(i[12]=r=>o.showKeyConfirm=r),"max-width":"450",persistent:""},{default:t(()=>[s(P,null,{default:t(()=>[s(I,{class:"text-h6 bg-error d-flex align-center"},{default:t(()=>[s(h,{start:"",class:"me-2"},{default:t(()=>[d("mdi-alert-circle-outline")]),_:1}),d(" 确认保存 ")]),_:1}),s(x,{class:"py-4 text-body-1 text-medium-emphasis"},{default:t(()=>[d(" 您没有填写 API Key，确定要保存吗？这可能会导致该服务提供商无法正常工作。 ")]),_:1}),s(E,null,{default:t(()=>[s(S),s(b,{color:"grey",variant:"text",onClick:i[10]||(i[10]=r=>l.handleKeyConfirm(!1))},{default:t(()=>[d("取消")]),_:1}),s(b,{color:"error",variant:"flat",onClick:i[11]||(i[11]=r=>l.handleKeyConfirm(!0))},{default:t(()=>[d("确定")]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])])}const Ee=F(fe,[["render",we],["__scopeId","data-v-6b7ea2a9"]]);export{Ee as default};
