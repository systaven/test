import{a5 as S,o as m,c as u,w as s,b as o,H as v,aa as w,k as P,n as E,ab as b,D as C,l as c,E as D,d as r,t as f,F as V,Q as G,f as T,W as x,B as k,p as A,X as B,u as X,_ as y,a6 as _,I as H,ag as R,e as h,U as O,ad as L}from"./index-427e6df5.js";import{A as U}from"./AstrBotConfig-8422f4c3.js";import{W as z}from"./WaitingForRestart-c0cfd70f.js";import{C as Q}from"./ConsoleDisplayer-b4e5ebdb.js";import{I as j}from"./ItemCard-7d8df7ff.js";import{_ as I}from"./_plugin-vue_export-helper-c27b6911.js";import{u as Y}from"./common-74ca9dd8.js";import"./index-c4200cc5.js";import"./KnowledgeBaseSelector-73bc8187.js";function W(e){if(e==="aiocqhttp"||e==="qq_official"||e==="qq_official_webhook")return new URL("/assets/qq-7a369eaf.png",self.location).href;if(e==="wecom"||e==="wecom_ai_bot")return new URL("/assets/wecom-7dfcf4e4.png",self.location).href;if(e==="wechatpadpro"||e==="weixin_official_account"||e==="wechat")return new URL("/assets/wechat-6a207b66.png",self.location).href;if(e==="lark")return new URL("data:image/png;base64,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",self.location).href;if(e==="dingtalk")return new URL("/assets/dingtalk-c6437bfa.svg",self.location).href;if(e==="telegram")return new URL("/assets/telegram-e782a1bf.svg",self.location).href;if(e==="discord")return new URL("/assets/discord-a137e6ae.svg",self.location).href;if(e==="slack")return new URL("/assets/slack-c0af31c6.svg",self.location).href;if(e==="kook")return new URL("data:image/png;base64,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",self.location).href;if(e==="vocechat")return new URL("/assets/vocechat-77bce3e6.png",self.location).href;if(e==="satori"||e==="Satori")return new URL("/assets/satori-7f1988af.png",self.location).href;if(e==="misskey")return new URL("/assets/misskey-9f74289e.png",self.location).href}function Z(e){return{qq_official_webhook:"https://docs.astrbot.app/deploy/platform/qqofficial/webhook.html",qq_official:"https://docs.astrbot.app/deploy/platform/qqofficial/websockets.html",aiocqhttp:"https://docs.astrbot.app/deploy/platform/aiocqhttp/napcat.html",wecom:"https://docs.astrbot.app/deploy/platform/wecom.html",wecom_ai_bot:"https://docs.astrbot.app/deploy/platform/wecom_ai_bot.html",lark:"https://docs.astrbot.app/deploy/platform/lark.html",telegram:"https://docs.astrbot.app/deploy/platform/telegram.html",dingtalk:"https://docs.astrbot.app/deploy/platform/dingtalk.html",wechatpadpro:"https://docs.astrbot.app/deploy/platform/wechat/wechatpadpro.html",weixin_official_account:"https://docs.astrbot.app/deploy/platform/weixin-official-account.html",discord:"https://docs.astrbot.app/deploy/platform/discord.html",slack:"https://docs.astrbot.app/deploy/platform/slack.html",kook:"https://docs.astrbot.app/deploy/platform/kook.html",vocechat:"https://docs.astrbot.app/deploy/platform/vocechat.html",satori:"https://docs.astrbot.app/deploy/platform/satori/llonebot.html",misskey:"https://docs.astrbot.app/deploy/platform/misskey.html"}[e]||"https://docs.astrbot.app"}function K(e,t){return t.includes("vocechat")?"由 @HikariFroya 提供。":t.includes("kook")?"由 @wuyan1003 提供。":""}const J={name:"AddNewPlatform",emits:["update:show","select-template"],props:{show:{type:Boolean,default:!1},metadata:{type:Object,default:()=>({})}},setup(){const{tm:e}=S("features/platform");return{tm:e}},computed:{showDialog:{get(){return this.show},set(e){this.$emit("update:show",e)}},platformTemplates(){var e,t,i;return((i=(t=(e=this.metadata.platform_group)==null?void 0:e.metadata)==null?void 0:t.platform)==null?void 0:i.config_template)||{}}},methods:{getPlatformIcon:W,getPlatformDescription:K,selectTemplate(e){this.$emit("select-template",e),this.closeDialog()},closeDialog(){this.showDialog=!1}}},F={class:"platform-card-content"},$={class:"platform-card-text"},ee={class:"platform-card-logo"},te=["src"],oe={key:1,class:"platform-logo-fallback"};function se(e,t,i,l,a,n){return m(),u(B,{modelValue:n.showDialog,"onUpdate:modelValue":t[0]||(t[0]=p=>n.showDialog=p),"max-width":"900px","min-height":"80%"},{default:s(()=>[o(C,{class:"platform-selection-dialog",title:l.tm("dialog.addPlatform")},{default:s(()=>[o(v,{class:"pa-4",style:{"overflow-y":"auto"}},{default:s(()=>[o(w,{style:{padding:"0px 8px"}},{default:s(()=>[(m(!0),P(V,null,E(n.platformTemplates,(p,g)=>(m(),u(b,{key:g,cols:"12",sm:"6",md:"6"},{default:s(()=>[o(C,{variant:"outlined",hover:"",class:"platform-card",onClick:N=>n.selectTemplate(g)},{default:s(()=>[c("div",F,[c("div",$,[o(D,{class:"platform-card-title"},{default:s(()=>[r(f(l.tm("dialog.connectTitle",{name:g})),1)]),_:2},1024),o(v,{class:"text-caption text-medium-emphasis platform-card-description"},{default:s(()=>[r(f(n.getPlatformDescription(p,g)),1)]),_:2},1024)]),c("div",ee,[n.getPlatformIcon(p.type)?(m(),P("img",{key:0,src:n.getPlatformIcon(p.type),class:"platform-logo-img"},null,8,te)):(m(),P("div",oe,f(g[0].toUpperCase()),1))])])]),_:2},1032,["onClick"])]),_:2},1024))),128)),Object.keys(n.platformTemplates).length===0?(m(),u(b,{key:0,cols:"12"},{default:s(()=>[o(G,{type:"info",variant:"tonal"},{default:s(()=>[r(f(l.tm("dialog.noTemplates")),1)]),_:1})]),_:1})):T("",!0)]),_:1})]),_:1}),o(x,null,{default:s(()=>[o(k),o(A,{text:"",onClick:n.closeDialog},{default:s(()=>[r(f(l.tm("dialog.cancel")),1)]),_:1},8,["onClick"])]),_:1})]),_:1},8,["title"])]),_:1},8,["modelValue"])}const ae=I(J,[["render",se],["__scopeId","data-v-f800e55f"]]);const le={name:"PlatformPage",components:{AstrBotConfig:U,WaitingForRestart:z,ConsoleDisplayer:Q,ItemCard:j,AddNewPlatform:ae},setup(){const{t:e}=X(),{tm:t}=S("features/platform");return{t:e,tm:t}},computed:{messages(){return{updateSuccess:this.tm("messages.updateSuccess"),addSuccess:this.tm("messages.addSuccess"),deleteSuccess:this.tm("messages.deleteSuccess"),statusUpdateSuccess:this.tm("messages.statusUpdateSuccess"),deleteConfirm:this.tm("messages.deleteConfirm")}}},data(){return{config_data:{},fetched:!1,metadata:{},showPlatformCfg:!1,showAddPlatformDialog:!1,newSelectedPlatformName:"",newSelectedPlatformConfig:{},updatingMode:!1,loading:!1,save_message_snack:!1,save_message:"",save_message_success:"success",showConsole:!1,showIdConflictDialog:!1,conflictId:"",idConflictResolve:null,showOneBotEmptyTokenWarnDialog:!1,oneBotEmptyTokenWarningResolve:null,store:Y()}},watch:{showIdConflictDialog(e){!e&&this.idConflictResolve&&(this.idConflictResolve(!1),this.idConflictResolve=null)},showOneBotEmptyTokenWarnDialog(e){!e&&this.oneBotEmptyTokenWarningResolve&&(this.oneBotEmptyTokenWarningResolve(!0),this.oneBotEmptyTokenWarningResolve=null)}},mounted(){this.getConfig()},methods:{getPlatformIcon(e){var i,l,a,n;const t=(n=(a=(l=(i=this.metadata.platform_group)==null?void 0:i.metadata)==null?void 0:l.platform)==null?void 0:a.config_template)==null?void 0:n[e];return t&&t.logo_token?`/api/file/${t.logo_token}`:W(e)},openTutorial(){const e=Z(this.newSelectedPlatformConfig.type);window.open(e,"_blank")},getConfig(){y.get("/api/config/get").then(e=>{this.config_data=e.data.data.config,this.fetched=!0,this.metadata=e.data.data.metadata}).catch(e=>{this.showError(e)})},selectPlatformTemplate(e){var t,i,l;this.newSelectedPlatformName=e,this.showPlatformCfg=!0,this.updatingMode=!1,this.newSelectedPlatformConfig=JSON.parse(JSON.stringify(((l=(i=(t=this.metadata.platform_group)==null?void 0:t.metadata)==null?void 0:i.platform)==null?void 0:l.config_template[e])||{}))},addFromDefaultConfigTmpl(e){var t,i,l;this.newSelectedPlatformName=e[0],this.showPlatformCfg=!0,this.updatingMode=!1,this.newSelectedPlatformConfig=JSON.parse(JSON.stringify(((l=(i=(t=this.metadata.platform_group)==null?void 0:t.metadata)==null?void 0:i.platform)==null?void 0:l.config_template[e[0]])||{}))},editPlatform(e){this.newSelectedPlatformName=e.id,this.newSelectedPlatformConfig=JSON.parse(JSON.stringify(e)),this.updatingMode=!0,this.showPlatformCfg=!0},newPlatform(){if(this.loading=!0,this.updatingMode){if(this.newSelectedPlatformConfig.type==="aiocqhttp"){const e=this.newSelectedPlatformConfig.ws_reverse_token;if(!e||e.trim()===""){this.showOneBotEmptyTokenWarning().then(t=>{t&&this.updatePlatform()});return}}this.updatePlatform()}else this.savePlatform()},updatePlatform(){y.post("/api/config/platform/update",{id:this.newSelectedPlatformName,config:this.newSelectedPlatformConfig}).then(e=>{this.loading=!1,this.showPlatformCfg=!1,this.getConfig(),this.showSuccess(e.data.message||this.messages.updateSuccess)}).catch(e=>{var t,i;this.loading=!1,this.showError(((i=(t=e.response)==null?void 0:t.data)==null?void 0:i.message)||e.message)}),this.updatingMode=!1},async savePlatform(){var t,i,l;if(((t=this.config_data.platform)==null?void 0:t.find(a=>a.id===this.newSelectedPlatformConfig.id))&&!await this.confirmIdConflict(this.newSelectedPlatformConfig.id)){this.loading=!1;return}if(this.newSelectedPlatformConfig.type==="aiocqhttp"){const a=this.newSelectedPlatformConfig.ws_reverse_token;if((!a||a.trim()==="")&&!await this.showOneBotEmptyTokenWarning())return}try{const a=await y.post("/api/config/platform/new",this.newSelectedPlatformConfig);this.loading=!1,this.showPlatformCfg=!1,this.getConfig(),this.showSuccess(a.data.message||this.messages.addSuccess)}catch(a){this.loading=!1,this.showError(((l=(i=a.response)==null?void 0:i.data)==null?void 0:l.message)||a.message)}},confirmIdConflict(e){return this.conflictId=e,this.showIdConflictDialog=!0,new Promise(t=>{this.idConflictResolve=t})},handleIdConflictConfirm(e){this.idConflictResolve&&this.idConflictResolve(e),this.showIdConflictDialog=!1},showOneBotEmptyTokenWarning(){return this.showOneBotEmptyTokenWarnDialog=!0,new Promise(e=>{this.oneBotEmptyTokenWarningResolve=e})},handleOneBotEmptyTokenWarningDismiss(e){this.showOneBotEmptyTokenWarnDialog=!1,this.oneBotEmptyTokenWarningResolve&&(this.oneBotEmptyTokenWarningResolve(e),this.oneBotEmptyTokenWarningResolve=null),e||(this.loading=!1)},deletePlatform(e){confirm(`${this.messages.deleteConfirm} ${e.id}?`)&&y.post("/api/config/platform/delete",{id:e.id}).then(t=>{this.getConfig(),this.showSuccess(t.data.message||this.messages.deleteSuccess)}).catch(t=>{var i,l;this.showError(((l=(i=t.response)==null?void 0:i.data)==null?void 0:l.message)||t.message)})},platformStatusChange(e){e.enable=!e.enable,y.post("/api/config/platform/update",{id:e.id,config:e}).then(t=>{this.getConfig(),this.showSuccess(t.data.message||this.messages.statusUpdateSuccess)}).catch(t=>{var i,l;e.enable=!e.enable,this.showError(((l=(i=t.response)==null?void 0:i.data)==null?void 0:l.message)||t.message)})},showSuccess(e){this.save_message=e,this.save_message_success="success",this.save_message_snack=!0},showError(e){this.save_message=e,this.save_message_success="error",this.save_message_snack=!0}}},ie={class:"platform-page"},ne={class:"text-h1 font-weight-bold mb-2"},re={class:"text-subtitle-1 text-medium-emphasis mb-4"},de={class:"text-grey mt-4"},fe={class:"text-h4"},ce={href:"https://docs.astrbot.app/deploy/platform/aiocqhttp/napcat.html#%E9%99%84%E5%BD%95-%E5%A2%9E%E5%BC%BA%E8%BF%9E%E6%8E%A5%E5%AE%89%E5%85%A8%E6%80%A7",target:"_blank"};function me(e,t,i,l,a,n){const p=_("item-card"),g=_("ConsoleDisplayer"),N=_("AddNewPlatform"),q=_("AstrBotConfig");return m(),P("div",ie,[o(H,{fluid:"",class:"pa-0"},{default:s(()=>[o(w,{class:"d-flex justify-space-between align-center px-4 py-3 pb-8"},{default:s(()=>[c("div",null,[c("h1",ne,[o(h,{color:"black",class:"me-2"},{default:s(()=>[r("mdi-connection")]),_:1}),r(f(l.tm("title")),1)]),c("p",re,f(l.tm("subtitle")),1)]),o(A,{color:"primary","prepend-icon":"mdi-plus",variant:"tonal",onClick:t[0]||(t[0]=d=>a.showAddPlatformDialog=!0),rounded:"xl",size:"x-large"},{default:s(()=>[r(f(l.tm("addAdapter")),1)]),_:1})]),_:1}),c("div",null,[(a.config_data.platform||[]).length===0?(m(),u(w,{key:0},{default:s(()=>[o(b,{cols:"12",class:"text-center pa-8"},{default:s(()=>[o(h,{size:"64",color:"grey-lighten-1"},{default:s(()=>[r("mdi-connection")]),_:1}),c("p",de,f(l.tm("emptyText")),1)]),_:1})]),_:1})):(m(),u(w,{key:1},{default:s(()=>[(m(!0),P(V,null,E(a.config_data.platform||[],(d,M)=>(m(),u(b,{key:M,cols:"12",md:"6",lg:"4",xl:"3"},{default:s(()=>[o(p,{item:d,"title-field":"id","enabled-field":"enable",bglogo:n.getPlatformIcon(d.type||d.id),onToggleEnabled:n.platformStatusChange,onDelete:n.deletePlatform,onEdit:n.editPlatform},null,8,["item","bglogo","onToggleEnabled","onDelete","onEdit"])]),_:2},1024))),128))]),_:1}))]),o(C,{elevation:"0",class:"mt-4"},{default:s(()=>[o(D,{class:"d-flex align-center py-3 px-4"},{default:s(()=>[o(h,{class:"me-2"},{default:s(()=>[r("mdi-console-line")]),_:1}),c("span",fe,f(l.tm("logs.title")),1),o(k),o(A,{variant:"text",color:"primary",onClick:t[1]||(t[1]=d=>a.showConsole=!a.showConsole)},{default:s(()=>[r(f(a.showConsole?l.tm("logs.collapse"):l.tm("logs.expand"))+" ",1),o(h,null,{default:s(()=>[r(f(a.showConsole?"mdi-chevron-up":"mdi-chevron-down"),1)]),_:1})]),_:1})]),_:1}),o(O),o(L,null,{default:s(()=>[a.showConsole?(m(),u(v,{key:0,class:"pa-0"},{default:s(()=>[o(g,{style:{"background-color":"#1e1e1e",height:"300px","border-radius":"0"}})]),_:1})):T("",!0)]),_:1})]),_:1})]),_:1}),o(N,{show:a.showAddPlatformDialog,"onUpdate:show":t[2]||(t[2]=d=>a.showAddPlatformDialog=d),metadata:a.metadata,onSelectTemplate:n.selectPlatformTemplate},null,8,["show","metadata","onSelectTemplate"]),o(B,{modelValue:a.showPlatformCfg,"onUpdate:modelValue":t[4]||(t[4]=d=>a.showPlatformCfg=d),persistent:"",width:"900px","max-width":"90%"},{default:s(()=>[o(C,{title:a.updatingMode?l.tm("dialog.edit"):l.tm("dialog.add")+` ${a.newSelectedPlatformName} `+l.tm("dialog.adapter")},{default:s(()=>[o(v,{class:"py-4"},{default:s(()=>[o(w,null,{default:s(()=>[o(b,{cols:"12"},{default:s(()=>{var d;return[o(q,{iterable:a.newSelectedPlatformConfig,metadata:(d=a.metadata.platform_group)==null?void 0:d.metadata,metadataKey:"platform"},null,8,["iterable","metadata"])]}),_:1})]),_:1}),o(w,{class:"mt-2"},{default:s(()=>[o(b,{cols:"12",class:"text-center"},{default:s(()=>[o(A,{color:"info",variant:"outlined",onClick:n.openTutorial},{default:s(()=>[o(h,{start:""},{default:s(()=>[r("mdi-book-open-variant")]),_:1}),r(" "+f(l.tm("dialog.viewTutorial")),1)]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1}),o(O),o(x,{class:"pa-4"},{default:s(()=>[o(k),o(A,{variant:"text",onClick:t[3]||(t[3]=d=>a.showPlatformCfg=!1),disabled:a.loading},{default:s(()=>[r(f(l.tm("dialog.cancel")),1)]),_:1},8,["disabled"]),o(A,{color:"primary",onClick:n.newPlatform,loading:a.loading},{default:s(()=>[r(f(l.tm("dialog.save")),1)]),_:1},8,["onClick","loading"])]),_:1})]),_:1},8,["title"])]),_:1},8,["modelValue"]),o(R,{timeout:3e3,elevation:"24",color:a.save_message_success,modelValue:a.save_message_snack,"onUpdate:modelValue":t[5]||(t[5]=d=>a.save_message_snack=d),location:"top"},{default:s(()=>[r(f(a.save_message),1)]),_:1},8,["color","modelValue"]),o(B,{modelValue:a.showIdConflictDialog,"onUpdate:modelValue":t[7]||(t[7]=d=>a.showIdConflictDialog=d),"max-width":"450",persistent:""},{default:s(()=>[o(C,null,{default:s(()=>[o(D,{class:"text-h6 bg-warning d-flex align-center"},{default:s(()=>[o(h,{start:"",class:"me-2"},{default:s(()=>[r("mdi-alert-circle-outline")]),_:1}),r(" "+f(l.tm("dialog.idConflict.title")),1)]),_:1}),o(v,{class:"py-4 text-body-1 text-medium-emphasis"},{default:s(()=>[r(f(l.tm("dialog.idConflict.message",{id:a.conflictId})),1)]),_:1}),o(x,null,{default:s(()=>[o(k),o(A,{color:"grey",variant:"text",onClick:t[6]||(t[6]=d=>n.handleIdConflictConfirm(!1))},{default:s(()=>[r(f(l.tm("dialog.idConflict.confirm")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),o(B,{modelValue:a.showOneBotEmptyTokenWarnDialog,"onUpdate:modelValue":t[10]||(t[10]=d=>a.showOneBotEmptyTokenWarnDialog=d),"max-width":"600",persistent:""},{default:s(()=>[o(C,null,{default:s(()=>[o(D,null,{default:s(()=>[r(f(l.tm("dialog.securityWarning.title")),1)]),_:1}),o(v,{class:"py-4"},{default:s(()=>[c("p",null,f(l.tm("dialog.securityWarning.aiocqhttpTokenMissing")),1),c("span",null,[c("a",ce,f(l.tm("dialog.securityWarning.learnMore")),1)])]),_:1}),o(x,{class:"px-4 pb-4"},{default:s(()=>[o(k),o(A,{color:"error",onClick:t[8]||(t[8]=d=>n.handleOneBotEmptyTokenWarningDismiss(!0))},{default:s(()=>[r(" 无视警告并继续创建 ")]),_:1}),o(A,{color:"primary",onClick:t[9]||(t[9]=d=>n.handleOneBotEmptyTokenWarningDismiss(!1))},{default:s(()=>[r(" 重新修改 ")]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])])}const ye=I(le,[["render",me],["__scopeId","data-v-e55c99ed"]]);export{ye as default};
