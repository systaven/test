import{a5 as W,_ as f,a6 as q,k as p,l as d,d as m,t as r,b as i,w as o,e as g,p as h,J,K as G,c as V,f as k,F as K,n as P,X as D,ag as X,o as c,x as F,D as v,E as S,H as w,Y as z,T as y,aB as Y,a7 as C,W as I,B as U,V as j,M as Z,N as L,ak as $,al as O,S as E,C as T,L as R,Q as M,aa as N,ab as x,aj as H,aJ as ee,aw as te,ax as le}from"./index-427e6df5.js";import{C as ie}from"./ConsoleDisplayer-b4e5ebdb.js";import{_ as se}from"./_plugin-vue_export-helper-c27b6911.js";import"./common-74ca9dd8.js";const oe={name:"KnowledgeBase",components:{ConsoleDisplayer:ie},setup(){const{tm:l}=W("features/alkaid/knowledge-base");return{tm:l}},data(){return{installed:!0,installing:!1,kbCollections:[],showCreateDialog:!1,showEmojiPicker:!1,newKB:{name:"",emoji:"ðŸ™‚",description:"",embedding_provider_id:null,rerank_provider_id:null},snackbar:{show:!1,text:"",color:"success"},emojiCategories:[{key:"emotions",emojis:["ðŸ˜€","ðŸ˜ƒ","ðŸ˜„","ðŸ˜","ðŸ˜†","ðŸ˜…","ðŸ¤£","ðŸ˜‚","ðŸ™‚","ðŸ™ƒ","ðŸ˜‰","ðŸ˜Š","ðŸ˜‡","ðŸ¥°","ðŸ˜","ðŸ¤©","ðŸ˜˜"]},{key:"animals",emojis:["ðŸ¶","ðŸ±","ðŸ­","ðŸ¹","ðŸ°","ðŸ¦Š","ðŸ»","ðŸ¼","ðŸ¨","ðŸ¯","ðŸ¦","ðŸ®","ðŸ·","ðŸ¸","ðŸµ"]},{key:"food",emojis:["ðŸ","ðŸŽ","ðŸ","ðŸŠ","ðŸ‹","ðŸŒ","ðŸ‰","ðŸ‡","ðŸ“","ðŸˆ","ðŸ’","ðŸ‘","ðŸ¥­","ðŸ","ðŸ¥¥"]},{key:"activities",emojis:["âš½","ðŸ€","ðŸˆ","âš¾","ðŸ¥Ž","ðŸŽ¾","ðŸ","ðŸ‰","ðŸŽ±","ðŸ“","ðŸ¸","ðŸ¥…","ðŸ’","ðŸ‘","ðŸ¥"]},{key:"travel",emojis:["ðŸš—","ðŸš•","ðŸš™","ðŸšŒ","ðŸšŽ","ðŸŽï¸","ðŸš“","ðŸš‘","ðŸš’","ðŸš","ðŸšš","ðŸš›","ðŸšœ","ðŸ›´","ðŸš²"]},{key:"symbols",emojis:["â¤ï¸","ðŸ§¡","ðŸ’›","ðŸ’š","ðŸ’™","ðŸ’œ","ðŸ–¤","ðŸ¤","ðŸ¤Ž","ðŸ’”","â£ï¸","ðŸ’•","ðŸ’ž","ðŸ’“","ðŸ’—"]}],showContentDialog:!1,currentKB:{collection_name:"",emoji:""},activeTab:"import",dataSource:"file",dataSourceOptions:[{title:"ä»Žæ–‡ä»¶",value:"file",icon:"mdi-file-upload"},{title:"ä»ŽURL",value:"url",icon:"mdi-web"}],selectedFile:null,chunkSize:null,overlap:null,uploading:!1,searchQuery:"",searchResults:[],searching:!1,searchPerformed:!1,topK:5,showDeleteDialog:!1,deleteTarget:{collection_name:""},deleting:!1,embeddingProviderConfigs:[],rerankProviderConfigs:[],llmProviderConfigs:[],importUrl:"",importOptions:{use_llm_repair:!0,use_clustering_summary:!1,repair_llm_provider_id:null,summarize_llm_provider_id:null,embedding_provider_id:null,chunk_size:300,chunk_overlap:50},importing:!1,pollingInterval:null,checkingUpdate:!1,updatingPlugin:!1,pluginHasUpdate:!1,pluginCurrentVersion:"",pluginLatestVersion:""}},computed:{optionalSelectorColWidth(){const l=this.importOptions.use_llm_repair,e=this.importOptions.use_clustering_summary;return l&&e?6:12}},watch:{llmProviderConfigs:{handler(l){l&&l.length>0&&(this.importOptions.repair_llm_provider_id||(this.importOptions.repair_llm_provider_id=l[0].id),this.importOptions.summarize_llm_provider_id||(this.importOptions.summarize_llm_provider_id=l[0].id))},immediate:!0,deep:!0},embeddingProviderConfigs:{handler(l){l&&l.length>0&&(this.importOptions.embedding_provider_id||(this.importOptions.embedding_provider_id=l[0].id))},immediate:!0,deep:!0}},mounted(){this.checkPlugin(),this.getProviderList()},methods:{llmModelProps(l){return{title:l.llm_model||l.id,subtitle:`Provider ID: ${l.id}`}},embeddingModelProps(l){return{title:l.embedding_model,subtitle:this.tm("createDialog.providerInfo",{id:l.id,dimensions:l.embedding_dimensions})}},rerankModelProps(l){return{title:l.rerank_model,subtitle:this.tm("createDialog.rerankProviderInfo",{id:l.id})}},checkPlugin(){f.get("/api/plugin/get?name=astrbot_plugin_knowledge_base").then(l=>{if(l.data.status!=="ok"||l.data.data.length===0){this.showSnackbar(this.tm("messages.pluginNotAvailable"),"error");return}if(!l.data.data[0].activated){this.showSnackbar(this.tm("messages.pluginNotActivated"),"error");return}l.data.data.length>0?(this.installed=!0,this.pluginCurrentVersion=l.data.data[0].version||"æœªçŸ¥",this.getKBCollections(),this.checkPluginUpdate()):this.installed=!1}).catch(l=>{console.error("Error checking plugin:",l),this.showSnackbar(this.tm("messages.checkPluginFailed"),"error")})},async checkPluginUpdate(){this.checkingUpdate=!0,this.pluginHasUpdate=!1;try{const l=await f.get("/api/plugin/market_list");if(l.data.status==="ok"){const e=l.data.data.astrbot_plugin_knowledge_base;e?(this.pluginLatestVersion=e.version||"æœªçŸ¥",this.pluginCurrentVersion&&this.pluginLatestVersion&&this.pluginCurrentVersion!=="æœªçŸ¥"&&this.pluginLatestVersion!=="æœªçŸ¥"&&(this.pluginHasUpdate=this.pluginCurrentVersion!=this.pluginLatestVersion),this.pluginHasUpdate?this.showSnackbar(this.tm("messages.updateAvailable",{current:this.pluginCurrentVersion,latest:this.pluginLatestVersion}),"info"):this.showSnackbar(this.tm("messages.pluginUpToDate"),"success")):this.showSnackbar(this.tm("messages.pluginNotFoundInMarket"),"warning")}else this.showSnackbar(this.tm("messages.checkUpdateFailed"),"error")}catch(l){console.error("Error checking plugin update:",l),this.showSnackbar(this.tm("messages.checkUpdateFailed"),"error")}finally{this.checkingUpdate=!1}},async updatePlugin(){this.updatingPlugin=!0;try{const l=await f.post("/api/plugin/update",{name:"astrbot_plugin_knowledge_base",proxy:localStorage.getItem("selectedGitHubProxy")||""});l.data.status==="ok"?(this.showSnackbar(this.tm("messages.updateSuccess"),"success"),this.pluginHasUpdate=!1,this.pluginCurrentVersion=this.pluginLatestVersion,this.checkPlugin()):this.showSnackbar(l.data.message||this.tm("messages.updateFailed"),"error")}catch(l){console.error("Error updating plugin:",l),this.showSnackbar(this.tm("messages.updatePluginFailed"),"error")}finally{this.updatingPlugin=!1}},installPlugin(){this.installing=!0,f.post("/api/plugin/install",{url:"https://github.com/lxfight/astrbot_plugin_knowledge_base",proxy:localStorage.getItem("selectedGitHubProxy")||""}).then(l=>{l.data.status==="ok"?this.checkPlugin():this.showSnackbar(l.data.message||this.tm("messages.installFailed"),"error")}).catch(l=>{console.error("Error installing plugin:",l),this.showSnackbar(this.tm("messages.installPluginFailed"),"error")}).finally(()=>{this.installing=!1})},getKBCollections(){f.get("/api/plug/alkaid/kb/collections").then(l=>{if(l.data.status!=="ok"){this.showSnackbar(l.data.message||this.tm("messages.getKnowledgeBaseListFailed"),"error");return}this.kbCollections=l.data.data}).catch(l=>{console.error("Error fetching knowledge base collections:",l),this.showSnackbar(this.tm("messages.getKnowledgeBaseListFailed"),"error")})},createCollection(l,e,u){this.newKB.embedding_provider_id&&typeof this.newKB.embedding_provider_id=="object"&&(this.newKB.embedding_provider_id=this.newKB.embedding_provider_id.id||""),this.newKB.rerank_provider_id&&typeof this.newKB.rerank_provider_id=="object"&&(this.newKB.rerank_provider_id=this.newKB.rerank_provider_id.id||""),f.post("/api/plug/alkaid/kb/create_collection",{collection_name:l,emoji:e,description:u,embedding_provider_id:this.newKB.embedding_provider_id||"",rerank_provider_id:this.newKB.rerank_provider_id||""}).then(a=>{a.data.status==="ok"?(this.showSnackbar(this.tm("messages.knowledgeBaseCreated")),this.getKBCollections(),this.showCreateDialog=!1,this.resetNewKB()):this.showSnackbar(a.data.message||this.tm("messages.createFailed"),"error")}).catch(a=>{console.error("Error creating knowledge base collection:",a),this.showSnackbar(this.tm("messages.createKnowledgeBaseFailed"),"error")})},submitCreateForm(){if(!this.newKB.name){this.showSnackbar(this.tm("messages.pleaseEnterKnowledgeBaseName"),"warning");return}this.createCollection(this.newKB.name,this.newKB.emoji||"ðŸ™‚",this.newKB.description,this.newKB.embedding_provider_id||"")},resetNewKB(){this.newKB={name:"",emoji:"ðŸ™‚",description:"",embedding_provider:""}},openKnowledgeBase(l){this.currentKB=l,this.showContentDialog=!0,this.resetContentDialog()},resetContentDialog(){this.activeTab="import",this.dataSource="file",this.selectedFile=null,this.searchQuery="",this.searchResults=[],this.searchPerformed=!1,this.chunkSize=null,this.overlap=null,this.importUrl="",this.importing=!1,this.pollingInterval&&(clearInterval(this.pollingInterval),this.pollingInterval=null)},triggerFileInput(){this.$refs.fileInput.click()},onFileSelected(l){const e=l.target.files;e.length>0&&(this.selectedFile=e[0])},onFileDrop(l){const e=l.dataTransfer.files;e.length>0&&(this.selectedFile=e[0])},getFileIcon(l){switch(l.split(".").pop().toLowerCase()){case"pdf":return"mdi-file-pdf-box";case"doc":case"docx":return"mdi-file-word-box";case"xls":case"xlsx":return"mdi-file-excel-box";case"ppt":case"pptx":return"mdi-file-powerpoint-box";case"txt":return"mdi-file-document-outline";default:return"mdi-file-outline"}},uploadFile(){if(!this.selectedFile){this.showSnackbar(this.tm("messages.pleaseSelectFile"),"warning");return}this.uploading=!0;const l=new FormData;l.append("file",this.selectedFile),l.append("collection_name",this.currentKB.collection_name),this.chunkSize&&this.chunkSize>0&&l.append("chunk_size",this.chunkSize),this.overlap&&this.overlap>=0&&l.append("chunk_overlap",this.overlap),f.post("/api/plug/alkaid/kb/collection/add_file",l,{headers:{"Content-Type":"multipart/form-data"}}).then(e=>{e.data.status==="ok"?(this.showSnackbar(this.tm("messages.operationSuccess",{message:e.data.message})),this.selectedFile=null,this.getKBCollections()):this.showSnackbar(e.data.message||this.tm("messages.uploadFailed"),"error")}).catch(e=>{console.error("Error uploading file:",e),this.showSnackbar(this.tm("messages.fileUploadFailed"),"error")}).finally(()=>{this.uploading=!1})},searchKnowledgeBase(){if(!this.searchQuery.trim()){this.showSnackbar(this.tm("messages.pleaseEnterSearchContent"),"warning");return}this.searching=!0,this.searchPerformed=!0,f.get("/api/plug/alkaid/kb/collection/search",{params:{collection_name:this.currentKB.collection_name,query:this.searchQuery,top_k:this.topK}}).then(l=>{l.data.status==="ok"?(this.searchResults=l.data.data||[],this.searchResults.length===0&&this.showSnackbar(this.tm("messages.noMatchingContent"),"info")):(this.showSnackbar(l.data.message||this.tm("messages.searchFailed"),"error"),this.searchResults=[])}).catch(l=>{console.error("Error searching knowledge base:",l),this.showSnackbar(this.tm("messages.searchKnowledgeBaseFailed"),"error"),this.searchResults=[]}).finally(()=>{this.searching=!1})},showSnackbar(l,e="success"){this.snackbar.text=l,this.snackbar.color=e,this.snackbar.show=!0},selectEmoji(l){this.newKB.emoji=l,this.showEmojiPicker=!1},confirmDelete(l){this.deleteTarget=l,this.showDeleteDialog=!0},deleteKnowledgeBase(){if(!this.deleteTarget.collection_name){this.showSnackbar(this.tm("messages.deleteTargetNotExists"),"error");return}this.deleting=!0,f.get("/api/plug/alkaid/kb/collection/delete",{params:{collection_name:this.deleteTarget.collection_name}}).then(l=>{l.data.status==="ok"?(this.showSnackbar(this.tm("messages.knowledgeBaseDeleted")),this.getKBCollections(),this.showDeleteDialog=!1):this.showSnackbar(l.data.message||this.tm("messages.deleteFailed"),"error")}).catch(l=>{console.error("Error deleting knowledge base:",l),this.showSnackbar(this.tm("messages.deleteKnowledgeBaseFailed"),"error")}).finally(()=>{this.deleting=!1})},getProviderList(){f.get("/api/config/provider/list",{params:{provider_type:"embedding,rerank,chat_completion"}}).then(l=>{if(l.data.status==="ok")this.embeddingProviderConfigs=l.data.data.filter(e=>e.provider_type==="embedding"),this.rerankProviderConfigs=l.data.data.filter(e=>e.provider_type==="rerank"),this.llmProviderConfigs=l.data.data.filter(e=>e.provider_type==="chat_completion");else return this.showSnackbar(l.data.message||this.tm("messages.getEmbeddingModelListFailed"),"error"),[]}).catch(l=>(console.error("Error fetching embedding providers:",l),this.showSnackbar(this.tm("messages.getEmbeddingModelListFailed"),"error"),[]))},openUrl(l){window.open(l,"_blank")},async startImportFromUrl(){var l,e;if(!this.importUrl){this.showSnackbar("Please enter a URL","warning");return}this.importing=!0;try{const u={url:this.importUrl,...Object.fromEntries(Object.entries(this.importOptions).filter(([n,_])=>_!==""&&_!==null&&_!==void 0))};console.log("Starting URL import with payload:",JSON.stringify(u,null,2));const a=await f.post("/api/plug/url_2_kb/add",u);if(!a.data.task_id)throw new Error(a.data.message||"Failed to start import task: No task_id received.");const t=a.data.task_id;this.pollTaskStatus(t)}catch(u){const a=((e=(l=u.response)==null?void 0:l.data)==null?void 0:e.message)||u.message||"An unknown error occurred.";this.showSnackbar(`Error: ${a}`,"error"),this.importing=!1}},pollTaskStatus(l){this.pollingInterval=setInterval(async()=>{var e,u;try{const t=(await f.post("/api/plug/url_2_kb/status",{task_id:l})).data,n=t.status;if(n==="completed")clearInterval(this.pollingInterval),this.pollingInterval=null,this.showSnackbar(this.tm("importFromUrl.uploadingChunks"),"info"),this.handleImportResult(t);else if(n==="failed"){clearInterval(this.pollingInterval),this.pollingInterval=null;const _=t.result||"Unknown reason.";this.showSnackbar(`${this.tm("importFromUrl.importFailed")}: ${_}`,"error"),this.importing=!1}}catch(a){clearInterval(this.pollingInterval),this.pollingInterval=null;const t=((u=(e=a.response)==null?void 0:e.data)==null?void 0:u.message)||a.message||"An unknown error occurred during polling.";this.showSnackbar(`Polling Error: ${t}`,"error"),this.importing=!1}},3e3)},async handleImportResult(l){const e=[],u=l.result;if(u.overall_summary&&e.push({content:u.overall_summary,filename:"overall_summary.txt"}),u.topics&&u.topics.length>0&&u.topics.forEach(n=>{n.topic_summary&&e.push({content:n.topic_summary,filename:`topic_${n.topic_id}_summary.txt`})}),u.noise_points&&u.noise_points.length>0&&u.noise_points.forEach((n,_)=>{const s=typeof n=="object"&&n.text?n.text:n;e.push({content:s,filename:`noise_${_+1}.txt`})}),e.length===0){this.showSnackbar("URL processed, but no text chunks were extracted.","info"),this.importing=!1;return}let a=0,t=0;for(let n=0;n<e.length;n++){const _=e[n];try{await this.uploadChunkAsFile(_.content,_.filename),a++}catch{t++}}t===0?this.showSnackbar(this.tm("importFromUrl.allChunksUploaded"),"success"):a>0?this.showSnackbar("Import partially complete. See console for details.","warning"):this.showSnackbar("Import failed. No chunks were uploaded.","error"),this.importing=!1,this.getKBCollections()},async uploadChunkAsFile(l,e){const u=new Blob([l],{type:"text/plain"}),a=new File([u],e,{type:"text/plain"}),t=new FormData;t.append("file",a),t.append("collection_name",this.currentKB.collection_name),this.importOptions.chunk_size&&this.importOptions.chunk_size>0&&t.append("chunk_size",this.importOptions.chunk_size),this.importOptions.chunk_overlap&&this.importOptions.chunk_overlap>=0&&t.append("chunk_overlap",this.importOptions.chunk_overlap);const n=await f.post("/api/plug/alkaid/kb/collection/add_file",t,{headers:{"Content-Type":"multipart/form-data"}});if(n.data.status!=="ok")throw new Error(n.data.message||"Chunk upload failed");return n.data}},beforeUnmount(){this.pollingInterval&&clearInterval(this.pollingInterval)}},A=l=>(te("data-v-32ffc0c9"),l=l(),le(),l),ae={class:"flex-grow-1",style:{display:"flex","flex-direction":"column",height:"100%"}},re={style:{"flex-grow":"1",width:"100%",border:"1px solid #eee","border-radius":"8px",padding:"16px"}},ne={key:0,class:"d-flex align-center justify-center flex-column",style:{"flex-grow":"1",width:"100%",height:"100%"}},de={key:1,class:"d-flex align-center justify-center flex-column",style:{"flex-grow":"1",width:"100%",height:"100%"}},me={key:2},ce={class:"mb-4"},ue={class:"kb-grid"},pe=["onClick"],he=A(()=>d("div",{class:"book-spine"},null,-1)),ge={class:"book-content"},fe={class:"emoji-container"},_e={class:"kb-emoji"},ke={class:"kb-name"},be={class:"kb-count"},ve={class:"kb-actions"},we={style:{width:"100%",display:"flex","align-items":"center","justify-content":"center"}},ye={class:"emoji-picker"},Ce={class:"text-subtitle-2 mb-2"},xe={class:"emoji-grid"},Ve=["onClick"],Se={class:"me-2 emoji-sm"},Fe={key:0,class:"px-6 py-2"},Ue={style:{"margin-left":"8px"}},Be={class:"import-container pa-4"},Ke=A(()=>d("div",{class:"mb-8"},[d("h2",null,"å¯¼å…¥æ•°æ®"),d("p",{class:"text-subtitle-1"},"é€‰æ‹©æ•°æ®æºå¹¶å¯¼å…¥å†…å®¹åˆ°çŸ¥è¯†åº“")],-1)),Pe={key:0,class:"mt-4"},De={class:"mt-2"},Ie={class:"text-subtitle-1 font-weight-bold"},je={class:"d-flex flex-wrap",style:{gap:"8px"}},ze={key:0,class:"selected-files mt-4"},Le={type:"info",variant:"tonal",class:"d-flex align-center"},Oe={style:{"font-weight":"1000"}},Ee={class:"text-center mt-4"},Te={key:1,class:"upload-progress mt-4"},Re={key:1,class:"from-url-container"},Me={class:"text-subtitle-1 font-weight-bold"},Ne={class:"text-center"},He={class:"search-container pa-4"},Ae={class:"search-results mt-4"},Qe={key:0},We={class:"text-center mt-4"},qe={key:1},Je={class:"mb-2"},Ge={class:"d-flex align-center mb-2"},Xe={class:"text-caption text-medium-emphasis"},Ye={class:"search-content"},Ze={key:2},$e={class:"text-red"};function et(l,e,u,a,t,n){const _=q("ConsoleDisplayer");return c(),p("div",ae,[d("div",re,[t.installed?t.kbCollections.length==0?(c(),p("div",de,[d("h2",null,r(a.tm("empty.title")),1),i(h,{style:{"margin-top":"16px"},variant:"tonal",color:"primary",onClick:e[1]||(e[1]=s=>t.showCreateDialog=!0)},{default:o(()=>[m(r(a.tm("empty.create")),1)]),_:1})])):(c(),p("div",me,[d("h2",ce,[m(r(a.tm("list.title"))+" ",1),i(g,{class:"ml-2",size:"x-small",color:"grey",onClick:e[2]||(e[2]=s=>n.openUrl("https://astrbot.app/use/knowledge-base.html"))},{default:o(()=>[m("mdi-information-outline")]),_:1})]),i(h,{class:"mb-4","prepend-icon":"mdi-plus",variant:"tonal",color:"primary",onClick:e[3]||(e[3]=s=>t.showCreateDialog=!0)},{default:o(()=>[m(r(a.tm("list.create")),1)]),_:1}),i(h,{class:"mb-4 ml-4","prepend-icon":"mdi-cog",variant:"tonal",color:"success",onClick:e[4]||(e[4]=s=>l.$router.push("/extension?open_config=astrbot_plugin_knowledge_base"))},{default:o(()=>[m(r(a.tm("list.config")),1)]),_:1}),i(h,{class:"mb-4 ml-4","prepend-icon":"mdi-update",variant:"tonal",color:"warning",onClick:n.checkPluginUpdate,loading:t.checkingUpdate},{default:o(()=>[m(r(a.tm("list.checkUpdate")),1)]),_:1},8,["onClick","loading"]),t.pluginHasUpdate?(c(),V(h,{key:0,class:"mb-4 ml-4","prepend-icon":"mdi-download",variant:"tonal",color:"primary",onClick:n.updatePlugin,loading:t.updatingPlugin},{default:o(()=>[m(r(a.tm("list.updatePlugin",{version:t.pluginLatestVersion})),1)]),_:1},8,["onClick","loading"])):k("",!0),d("div",ue,[(c(!0),p(K,null,P(t.kbCollections,(s,b)=>(c(),p("div",{key:b,class:"kb-card",onClick:B=>n.openKnowledgeBase(s)},[he,d("div",ge,[d("div",fe,[d("span",_e,r(s.emoji||"ðŸ™‚"),1)]),d("div",ke,r(s.collection_name),1),d("div",be,r(s.count||0)+" "+r(a.tm("list.knowledgeCount")),1),d("div",ve,[i(h,{icon:"",variant:"text",size:"small",color:"error",onClick:F(B=>n.confirmDelete(s),["stop"])},{default:o(()=>[i(g,null,{default:o(()=>[m("mdi-delete")]),_:1})]),_:2},1032,["onClick"])])])],8,pe))),128))])])):(c(),p("div",ne,[d("h2",null,[m(r(a.tm("notInstalled.title"))+" ",1),i(g,{class:"ml-2",size:"small",color:"grey",onClick:e[0]||(e[0]=s=>n.openUrl("https://astrbot.app/use/knowledge-base.html"))},{default:o(()=>[m("mdi-information-outline")]),_:1})]),i(h,{style:{"margin-top":"16px"},variant:"tonal",color:"primary",onClick:n.installPlugin,loading:t.installing},{default:o(()=>[m(r(a.tm("notInstalled.install")),1)]),_:1},8,["onClick","loading"]),J(i(_,{style:{"background-color":"#fff","max-height":"300px","margin-top":"16px","max-width":"100%"},"show-level-btns":!1},null,512),[[G,t.installing]])]))]),i(D,{modelValue:t.showCreateDialog,"onUpdate:modelValue":e[11]||(e[11]=s=>t.showCreateDialog=s),"max-width":"500px"},{default:o(()=>[i(v,null,{default:o(()=>[i(S,{class:"text-h4"},{default:o(()=>[m(r(a.tm("createDialog.title")),1)]),_:1}),i(w,null,{default:o(()=>[d("div",we,[d("span",{id:"emoji-display",onClick:e[5]||(e[5]=s=>t.showEmojiPicker=!0)},r(t.newKB.emoji||"ðŸ™‚"),1)]),i(z,{onSubmit:F(n.submitCreateForm,["prevent"])},{default:o(()=>[i(y,{variant:"outlined",modelValue:t.newKB.name,"onUpdate:modelValue":e[6]||(e[6]=s=>t.newKB.name=s),label:a.tm("createDialog.nameLabel"),required:""},null,8,["modelValue","label"]),i(Y,{modelValue:t.newKB.description,"onUpdate:modelValue":e[7]||(e[7]=s=>t.newKB.description=s),label:a.tm("createDialog.descriptionLabel"),variant:"outlined",placeholder:a.tm("createDialog.descriptionPlaceholder"),rows:"3"},null,8,["modelValue","label","placeholder"]),i(C,{modelValue:t.newKB.embedding_provider_id,"onUpdate:modelValue":e[8]||(e[8]=s=>t.newKB.embedding_provider_id=s),items:t.embeddingProviderConfigs,"item-props":n.embeddingModelProps,label:a.tm("createDialog.embeddingModelLabel"),variant:"outlined",density:"comfortable"},null,8,["modelValue","items","item-props","label"]),i(C,{modelValue:t.newKB.rerank_provider_id,"onUpdate:modelValue":e[9]||(e[9]=s=>t.newKB.rerank_provider_id=s),items:t.rerankProviderConfigs,"item-props":n.rerankModelProps,label:a.tm("createDialog.rerankModelLabel"),variant:"outlined",density:"comfortable"},null,8,["modelValue","items","item-props","label"]),d("small",null,r(a.tm("createDialog.tips")),1)]),_:1},8,["onSubmit"])]),_:1}),i(I,null,{default:o(()=>[i(U),i(h,{color:"error",variant:"text",onClick:e[10]||(e[10]=s=>t.showCreateDialog=!1)},{default:o(()=>[m(r(a.tm("createDialog.cancel")),1)]),_:1}),i(h,{color:"primary",variant:"text",onClick:n.submitCreateForm},{default:o(()=>[m(r(a.tm("createDialog.create")),1)]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),i(D,{modelValue:t.showEmojiPicker,"onUpdate:modelValue":e[13]||(e[13]=s=>t.showEmojiPicker=s),"max-width":"400px"},{default:o(()=>[i(v,null,{default:o(()=>[i(S,{class:"text-h6"},{default:o(()=>[m(r(a.tm("emojiPicker.title")),1)]),_:1}),i(w,null,{default:o(()=>[d("div",ye,[(c(!0),p(K,null,P(t.emojiCategories,(s,b)=>(c(),p("div",{key:b,class:"mb-4"},[d("div",Ce,r(a.tm(`emojiPicker.categories.${s.key}`)),1),d("div",xe,[(c(!0),p(K,null,P(s.emojis,(B,Q)=>(c(),p("div",{key:Q,class:"emoji-item",onClick:tt=>n.selectEmoji(B)},r(B),9,Ve))),128))])]))),128))])]),_:1}),i(I,null,{default:o(()=>[i(U),i(h,{color:"primary",variant:"text",onClick:e[12]||(e[12]=s=>t.showEmojiPicker=!1)},{default:o(()=>[m(r(a.tm("emojiPicker.close")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),i(D,{modelValue:t.showContentDialog,"onUpdate:modelValue":e[35]||(e[35]=s=>t.showContentDialog=s),"max-width":"1000px"},{default:o(()=>[i(v,null,{default:o(()=>[i(S,{class:"d-flex align-center"},{default:o(()=>[d("div",Se,r(t.currentKB.emoji||"ðŸ™‚"),1),d("span",null,r(t.currentKB.collection_name)+" - "+r(a.tm("contentDialog.title")),1),i(U),i(h,{variant:"plain",icon:"",onClick:e[14]||(e[14]=s=>t.showContentDialog=!1)},{default:o(()=>[i(g,null,{default:o(()=>[m("mdi-close")]),_:1})]),_:1})]),_:1}),t.currentKB._embedding_provider_config?(c(),p("div",Fe,[i(j,{class:"mr-2",color:"primary",variant:"tonal",size:"small",rounded:"sm"},{default:o(()=>[i(g,{start:"",size:"small"},{default:o(()=>[m("mdi-database")]),_:1}),m(" "+r(a.tm("contentDialog.embeddingModel"))+": "+r(t.currentKB._embedding_provider_config.embedding_model),1)]),_:1}),t.currentKB.rerank_provider_id?(c(),V(j,{key:0,color:"tertiary",variant:"tonal",size:"small",rounded:"sm"},{default:o(()=>{var s;return[i(g,{start:"",size:"small"},{default:o(()=>[m("mdi-sort-variant")]),_:1}),m(" é‡æŽ’åºæ¨¡åž‹: "+r(((s=t.rerankProviderConfigs.find(b=>b.id===t.currentKB.rerank_provider_id))==null?void 0:s.rerank_model)||"æœªè®¾ç½®"),1)]}),_:1})):k("",!0),d("small",Ue,'ðŸ’¡ ä½¿ç”¨æ–¹å¼: åœ¨èŠå¤©é¡µä¸­è¾“å…¥ "/kb use '+r(t.currentKB.collection_name)+'"',1)])):k("",!0),i(w,null,{default:o(()=>[i(Z,{modelValue:t.activeTab,"onUpdate:modelValue":e[15]||(e[15]=s=>t.activeTab=s)},{default:o(()=>[i(L,{value:"import"},{default:o(()=>[m("å¯¼å…¥æ•°æ®")]),_:1}),i(L,{value:"search"},{default:o(()=>[m(r(a.tm("contentDialog.tabs.search")),1)]),_:1})]),_:1},8,["modelValue"]),i($,{modelValue:t.activeTab,"onUpdate:modelValue":e[34]||(e[34]=s=>t.activeTab=s),class:"mt-4"},{default:o(()=>[i(O,{value:"import"},{default:o(()=>[d("div",Be,[Ke,i(C,{modelValue:t.dataSource,"onUpdate:modelValue":e[16]||(e[16]=s=>t.dataSource=s),items:t.dataSourceOptions,label:"æ•°æ®æºé€‰æ‹©",variant:"outlined","item-title":"title","item-value":"value","prepend-inner-icon":"mdi-database"},null,8,["modelValue","items"]),t.dataSource==="file"?(c(),p("div",Pe,[d("div",{class:"upload-zone",onDragover:e[18]||(e[18]=F(()=>{},["prevent"])),onDrop:e[19]||(e[19]=F((...s)=>n.onFileDrop&&n.onFileDrop(...s),["prevent"])),onClick:e[20]||(e[20]=(...s)=>n.triggerFileInput&&n.triggerFileInput(...s))},[d("input",{type:"file",ref:"fileInput",style:{display:"none"},onChange:e[17]||(e[17]=(...s)=>n.onFileSelected&&n.onFileSelected(...s))},null,544),i(g,{size:"48",color:"primary"},{default:o(()=>[m("mdi-cloud-upload")]),_:1}),d("p",De,r(a.tm("upload.dropzone")),1)],32),i(v,{class:"mt-4 chunk-settings-card",variant:"outlined",color:"grey-lighten-4"},{default:o(()=>[i(S,{class:"pa-4 pb-0 d-flex align-center"},{default:o(()=>[i(g,{color:"primary",class:"mr-2"},{default:o(()=>[m("mdi-puzzle-outline")]),_:1}),d("span",Ie,r(a.tm("upload.chunkSettings.title")),1),i(E,{location:"top"},{activator:o(({props:s})=>[i(g,T(s,{class:"ml-2",size:"small",color:"grey"}),{default:o(()=>[m(" mdi-information-outline ")]),_:2},1040)]),default:o(()=>[d("span",null,r(a.tm("upload.chunkSettings.tooltip")),1)]),_:1})]),_:1}),i(w,{class:"pa-4 pt-2"},{default:o(()=>[d("div",je,[i(y,{modelValue:t.chunkSize,"onUpdate:modelValue":e[21]||(e[21]=s=>t.chunkSize=s),label:a.tm("upload.chunkSettings.chunkSizeLabel"),type:"number",hint:a.tm("upload.chunkSettings.chunkSizeHint"),"persistent-hint":"",variant:"outlined",density:"comfortable",class:"flex-grow-1 chunk-field","prepend-inner-icon":"mdi-text-box-outline",min:"50"},null,8,["modelValue","label","hint"]),i(y,{modelValue:t.overlap,"onUpdate:modelValue":e[22]||(e[22]=s=>t.overlap=s),label:a.tm("upload.chunkSettings.overlapLabel"),type:"number",hint:a.tm("upload.chunkSettings.overlapHint"),"persistent-hint":"",variant:"outlined",density:"comfortable",class:"flex-grow-1 chunk-field","prepend-inner-icon":"mdi-vector-intersection",min:"0"},null,8,["modelValue","label","hint"])])]),_:1})]),_:1}),t.selectedFile?(c(),p("div",ze,[d("div",Le,[d("div",null,[i(g,{class:"me-2"},{default:o(()=>[m(r(n.getFileIcon(t.selectedFile.name)),1)]),_:1}),d("span",Oe,r(t.selectedFile.name),1)]),i(h,{size:"small",color:"error",variant:"text",onClick:e[23]||(e[23]=s=>t.selectedFile=null)},{default:o(()=>[i(g,null,{default:o(()=>[m("mdi-close")]),_:1})]),_:1})]),d("div",Ee,[i(h,{color:"primary",variant:"elevated",loading:t.uploading,disabled:!t.selectedFile,onClick:n.uploadFile},{default:o(()=>[m(r(a.tm("upload.upload")),1)]),_:1},8,["loading","disabled","onClick"])])])):k("",!0),t.uploading?(c(),p("div",Te,[i(R,{indeterminate:"",color:"primary"})])):k("",!0)])):k("",!0),t.dataSource==="url"?(c(),p("div",Re,[i(M,{type:"info",variant:"tonal",class:"mb-4",border:""},{default:o(()=>[m(r(a.tm("importFromUrl.preRequisite")),1)]),_:1}),i(y,{modelValue:t.importUrl,"onUpdate:modelValue":e[24]||(e[24]=s=>t.importUrl=s),label:a.tm("importFromUrl.urlLabel"),placeholder:a.tm("importFromUrl.urlPlaceholder"),variant:"outlined",class:"mb-4","hide-details":""},null,8,["modelValue","label","placeholder"]),i(v,{class:"mb-4",variant:"outlined",color:"grey-lighten-4"},{default:o(()=>[i(S,{class:"pa-4 pb-0 d-flex align-center"},{default:o(()=>[i(g,{color:"primary",class:"mr-2"},{default:o(()=>[m("mdi-cog-outline")]),_:1}),d("span",Me,r(a.tm("importFromUrl.optionsTitle")),1),i(E,{location:"top"},{activator:o(({props:s})=>[i(g,T(s,{class:"ml-2",size:"small",color:"grey"}),{default:o(()=>[m("mdi-information-outline")]),_:2},1040)]),default:o(()=>[d("span",null,r(a.tm("importFromUrl.tooltip")),1)]),_:1})]),_:1}),i(w,{class:"pa-4 pt-2"},{default:o(()=>[i(N,null,{default:o(()=>[i(x,{cols:"12",md:"6"},{default:o(()=>[i(H,{"hide-details":"",modelValue:t.importOptions.use_llm_repair,"onUpdate:modelValue":e[25]||(e[25]=s=>t.importOptions.use_llm_repair=s),label:a.tm("importFromUrl.useLlmRepairLabel"),color:"primary",inset:""},null,8,["modelValue","label"])]),_:1}),i(x,{cols:"12",md:"6"},{default:o(()=>[i(H,{modelValue:t.importOptions.use_clustering_summary,"onUpdate:modelValue":e[26]||(e[26]=s=>t.importOptions.use_clustering_summary=s),"hide-details":"",label:a.tm("importFromUrl.useClusteringSummaryLabel"),color:"primary",inset:""},null,8,["modelValue","label"])]),_:1}),i(N,{class:"pa-4"},{default:o(()=>[t.importOptions.use_llm_repair?(c(),V(x,{key:0,md:n.optionalSelectorColWidth,cols:"12"},{default:o(()=>[i(C,{modelValue:t.importOptions.repair_llm_provider_id,"onUpdate:modelValue":e[27]||(e[27]=s=>t.importOptions.repair_llm_provider_id=s),items:t.llmProviderConfigs,"item-value":"id","item-props":n.llmModelProps,label:a.tm("importFromUrl.repairLlmProviderIdLabel"),variant:"outlined",clearable:"","hide-details":""},null,8,["modelValue","items","item-props","label"])]),_:1},8,["md"])):k("",!0),t.importOptions.use_clustering_summary?(c(),V(x,{key:1,md:n.optionalSelectorColWidth,cols:"12"},{default:o(()=>[i(C,{modelValue:t.importOptions.summarize_llm_provider_id,"onUpdate:modelValue":e[28]||(e[28]=s=>t.importOptions.summarize_llm_provider_id=s),items:t.llmProviderConfigs,"item-value":"id","item-props":n.llmModelProps,label:a.tm("importFromUrl.summarizeLlmProviderIdLabel"),variant:"outlined",clearable:"","hide-details":""},null,8,["modelValue","items","item-props","label"])]),_:1},8,["md"])):k("",!0),i(x,{cols:"12",md:"6"},{default:o(()=>[i(C,{modelValue:t.importOptions.embedding_provider_id,"onUpdate:modelValue":e[29]||(e[29]=s=>t.importOptions.embedding_provider_id=s),items:t.embeddingProviderConfigs,"item-value":"id","item-props":n.embeddingModelProps,label:a.tm("importFromUrl.embeddingProviderIdLabel"),variant:"outlined",clearable:"","hide-details":""},null,8,["modelValue","items","item-props","label"])]),_:1}),i(x,{cols:"12",md:"3"},{default:o(()=>[i(y,{modelValue:t.importOptions.chunk_size,"onUpdate:modelValue":e[30]||(e[30]=s=>t.importOptions.chunk_size=s),label:a.tm("importFromUrl.chunkSizeLabel"),type:"number",variant:"outlined",clearable:"","hide-details":""},null,8,["modelValue","label"])]),_:1}),i(x,{cols:"12",md:"3"},{default:o(()=>[i(y,{modelValue:t.importOptions.chunk_overlap,"onUpdate:modelValue":e[31]||(e[31]=s=>t.importOptions.chunk_overlap=s),label:a.tm("importFromUrl.chunkOverlapLabel"),type:"number",variant:"outlined",clearable:"","hide-details":""},null,8,["modelValue","label"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),d("div",Ne,[i(h,{color:"primary",variant:"elevated",loading:t.importing,disabled:!t.importUrl,onClick:n.startImportFromUrl},{default:o(()=>[m(r(a.tm("importFromUrl.startImport")),1)]),_:1},8,["loading","disabled","onClick"])])])):k("",!0)])]),_:1}),i(O,{value:"search"},{default:o(()=>[d("div",He,[i(z,{onSubmit:F(n.searchKnowledgeBase,["prevent"]),class:"d-flex align-center"},{default:o(()=>[i(y,{modelValue:t.searchQuery,"onUpdate:modelValue":e[32]||(e[32]=s=>t.searchQuery=s),label:a.tm("search.queryLabel"),"append-icon":"mdi-magnify",variant:"outlined",class:"flex-grow-1 me-2","onClick:append":n.searchKnowledgeBase,onKeyup:ee(n.searchKnowledgeBase,["enter"]),placeholder:a.tm("search.queryPlaceholder"),"hide-details":""},null,8,["modelValue","label","onClick:append","onKeyup","placeholder"]),i(C,{modelValue:t.topK,"onUpdate:modelValue":e[33]||(e[33]=s=>t.topK=s),items:[3,5,10,20],label:a.tm("search.resultCountLabel"),variant:"outlined",style:{"max-width":"120px"},"hide-details":""},null,8,["modelValue","label"])]),_:1},8,["onSubmit"]),d("div",Ae,[t.searching?(c(),p("div",Qe,[i(R,{indeterminate:"",color:"primary"}),d("p",We,r(a.tm("search.searching")),1)])):t.searchResults.length>0?(c(),p("div",qe,[d("h3",Je,r(a.tm("search.resultsTitle")),1),(c(!0),p(K,null,P(t.searchResults,(s,b)=>(c(),V(v,{key:b,class:"mb-4 search-result-card",variant:"outlined"},{default:o(()=>[i(w,null,{default:o(()=>[d("div",Ge,[i(g,{class:"me-2",size:"small",color:"primary"},{default:o(()=>[m("mdi-file-document-outline")]),_:1}),d("span",Xe,r(s.metadata.source),1),i(U),s.score?(c(),V(j,{key:0,size:"small",color:"primary",variant:"tonal"},{default:o(()=>[m(r(a.tm("search.relevance"))+": "+r(Math.round(s.score*100))+"% ",1)]),_:2},1024)):k("",!0)]),d("div",Ye,r(s.content),1)]),_:2},1024)]),_:2},1024))),128))])):t.searchPerformed?(c(),p("div",Ze,[i(M,{type:"info",variant:"tonal"},{default:o(()=>[m(r(a.tm("search.noResults")),1)]),_:1})])):k("",!0)])])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),i(D,{modelValue:t.showDeleteDialog,"onUpdate:modelValue":e[37]||(e[37]=s=>t.showDeleteDialog=s),"max-width":"400px"},{default:o(()=>[i(v,null,{default:o(()=>[i(S,{class:"text-h5"},{default:o(()=>[m(r(a.tm("deleteDialog.title")),1)]),_:1}),i(w,null,{default:o(()=>[d("p",null,r(a.tm("deleteDialog.confirmText",{name:t.deleteTarget.collection_name})),1),d("p",$e,r(a.tm("deleteDialog.warning")),1)]),_:1}),i(I,null,{default:o(()=>[i(U),i(h,{color:"grey-darken-1",variant:"text",onClick:e[36]||(e[36]=s=>t.showDeleteDialog=!1)},{default:o(()=>[m(r(a.tm("deleteDialog.cancel")),1)]),_:1}),i(h,{color:"error",variant:"text",onClick:n.deleteKnowledgeBase,loading:t.deleting},{default:o(()=>[m(r(a.tm("deleteDialog.delete")),1)]),_:1},8,["onClick","loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),i(X,{modelValue:t.snackbar.show,"onUpdate:modelValue":e[38]||(e[38]=s=>t.snackbar.show=s),color:t.snackbar.color},{default:o(()=>[m(r(t.snackbar.text),1)]),_:1},8,["modelValue","color"])])}const at=se(oe,[["render",et],["__scopeId","data-v-32ffc0c9"]]);export{at as default};
