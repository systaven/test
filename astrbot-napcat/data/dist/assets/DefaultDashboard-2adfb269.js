import{a5 as v,o as m,c as h,w as o,b as s,l as t,e as p,t as a,V as P,d as u,f as C,H as x,D as w,_ as R,a6 as g,a7 as L,A as k,J as N,K as O,k as T,a8 as A,U as S,m as B,F as V,n as $,j as E,g as H,L as F,a9 as f,aa as M,p as j,Q as G,ab as b}from"./index-427e6df5.js";import{_ as y}from"./_plugin-vue_export-helper-c27b6911.js";import{u as J}from"./customizer-fda73318.js";const K={name:"TotalMessage",props:["stat"],setup(){const{tm:e}=v("features/dashboard");return{t:e}},computed:{formattedCount(){var r;const e=(r=this.stat)==null?void 0:r.message_count;return e?e.toLocaleString():"0"}}},Q={class:"d-flex align-start"},W={class:"icon-wrapper"},Y={class:"stat-content"},q={class:"stat-title"},X={class:"stat-value-wrapper"},Z={class:"stat-value"},tt={class:"stat-subtitle"};function et(e,r,l,i,n,c){return m(),h(w,{elevation:"1",class:"stat-card message-card"},{default:o(()=>[s(x,null,{default:o(()=>[t("div",Q,[t("div",W,[s(p,{icon:"mdi-message-text-outline",size:"24"})]),t("div",Y,[t("div",q,a(i.t("stats.totalMessage.title")),1),t("div",X,[t("h2",Z,a(c.formattedCount),1),l.stat.daily_increase?(m(),h(P,{key:0,class:"trend-chip",size:"x-small",color:"success"},{default:o(()=>[u(" +"+a(l.stat.daily_increase),1)]),_:1})):C("",!0)]),t("div",tt,a(i.t("stats.totalMessage.subtitle")),1)])])]),_:1})]),_:1})}const st=y(K,[["render",et],["__scopeId","data-v-cb286b34"]]);const at={name:"OnlinePlatform",props:["stat"],setup(){const{tm:e}=v("features/dashboard");return{t:e}}},ot={class:"d-flex align-start"},rt={class:"icon-wrapper"},nt={class:"stat-content"},it={class:"stat-title"},lt={class:"stat-value-wrapper"},ct={class:"stat-value"},dt={class:"stat-subtitle"};function mt(e,r,l,i,n,c){return m(),h(w,{elevation:"1",class:"stat-card platform-card"},{default:o(()=>[s(x,null,{default:o(()=>[t("div",ot,[t("div",rt,[s(p,{icon:"mdi-server-network",size:"24"})]),t("div",nt,[t("div",it,a(i.t("stats.onlinePlatform.title")),1),t("div",lt,[t("h2",ct,a(l.stat.platform_count||0),1)]),t("div",dt,a(i.t("stats.onlinePlatform.subtitle")),1)])])]),_:1})]),_:1})}const _t=y(at,[["render",mt],["__scopeId","data-v-6d0ac809"]]);const ht={name:"RunningTime",props:["stat"],setup(){const{tm:e}=v("features/dashboard");return{t:e}},computed:{formattedTime(){var i;if(!((i=this.stat)!=null&&i.running))return this.t("status.loading");const{hours:e,minutes:r,seconds:l}=this.stat.running;return this.t("stats.runningTime.format",{hours:e,minutes:r,seconds:l})}}},ut={class:"d-flex align-start"},ft={class:"icon-wrapper"},gt={class:"stat-content"},pt={class:"stat-title"},vt={class:"stat-value-wrapper"},yt={class:"stat-value"},bt={class:"stat-subtitle"};function Tt(e,r,l,i,n,c){return m(),h(w,{elevation:"1",class:"stat-card uptime-card"},{default:o(()=>[s(x,null,{default:o(()=>[t("div",ut,[t("div",ft,[s(p,{icon:"mdi-clock-outline",size:"24"})]),t("div",gt,[t("div",pt,a(i.t("stats.runningTime.title")),1),t("div",vt,[t("h2",yt,a(c.formattedTime),1)]),t("div",bt,a(i.t("stats.runningTime.subtitle")),1)])])]),_:1})]),_:1})}const xt=y(ht,[["render",Tt],["__scopeId","data-v-b763ca79"]]);const wt={name:"MemoryUsage",props:["stat"],setup(){const{tm:e}=v("features/dashboard");return{t:e}},computed:{memoryPercentage(){return!this.stat.memory||!this.stat.memory.process||!this.stat.memory.system?0:Math.round(this.stat.memory.process/this.stat.memory.system*100)},memoryStatus(){const e=this.memoryPercentage;return e<30?{color:"success",label:this.t("stats.memoryUsage.status.good")}:e<70?{color:"warning",label:this.t("stats.memoryUsage.status.normal")}:{color:"error",label:this.t("stats.memoryUsage.status.high")}}}},St={class:"d-flex align-start"},Mt={class:"icon-wrapper"},Rt={class:"stat-content"},Pt={class:"stat-title"},Ct={class:"stat-value-wrapper"},Vt={class:"stat-value"},$t={class:"memory-unit"},kt={class:"metrics-container"},Dt={class:"metric-item"},zt={class:"metric-label"},Ut={class:"metric-value"};function It(e,r,l,i,n,c){return m(),h(w,{elevation:"1",class:"stat-card memory-card"},{default:o(()=>[s(x,null,{default:o(()=>{var _,d;return[t("div",St,[t("div",Mt,[s(p,{icon:"mdi-memory",size:"24"})]),t("div",Rt,[t("div",Pt,a(i.t("stats.memoryUsage.title")),1),t("div",Ct,[t("h2",Vt,[u(a(((_=l.stat.memory)==null?void 0:_.process)||0)+" ",1),t("span",$t,"MiB / "+a(((d=l.stat.memory)==null?void 0:d.system)||0)+" MiB",1)]),s(P,{color:c.memoryStatus.color,size:"x-small",class:"status-chip"},{default:o(()=>[u(a(c.memoryStatus.label),1)]),_:1},8,["color"])])])]),t("div",kt,[t("div",Dt,[t("div",zt,a(i.t("stats.memoryUsage.cpuLoad")),1),t("div",Ut,a(l.stat.cpu_percent||"0")+"%",1)])])]}),_:1})]),_:1})}const Lt=y(wt,[["render",It],["__scopeId","data-v-c0414257"]]);const Nt={name:"MessageStat",props:["stat"],setup(){const{tm:e}=v("features/dashboard");return{t:e}},data(){return{totalMessages:"0",dailyAverage:"0",growthRate:0,loading:!1,selectedTimeRange:null,timeRanges:[],chartOptions:{chart:{type:"area",height:400,fontFamily:"inherit",foreColor:"#a1aab2",toolbar:{show:!0,tools:{download:!0,selection:!1,zoom:!0,zoomin:!0,zoomout:!0,pan:!0}},animations:{enabled:!0,easing:"easeinout",speed:800}},colors:["#5e35b1"],fill:{type:"solid",opacity:.3},dataLabels:{enabled:!1},stroke:{curve:"smooth",width:2},markers:{size:3,strokeWidth:2,hover:{size:5}},tooltip:{theme:J().uiTheme==="PurpleTheme"?"light":"dark",x:{format:"yyyy-MM-dd HH:mm"},y:{title:{formatter:()=>""}}},xaxis:{type:"datetime",title:{text:""},labels:{formatter:function(e){return new Date(e).toLocaleString("zh-CN",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}},tooltip:{enabled:!1}},yaxis:{title:{text:""},min:function(e){return e<10?0:Math.floor(e*.8)}},grid:{borderColor:"gray100",row:{colors:["transparent","transparent"],opacity:.2},column:{colors:["transparent","transparent"]},padding:{left:0,right:0}}},chartSeries:[{name:"",data:[]}],messageTimeSeries:[]}},mounted(){this.timeRanges=[{label:this.t("charts.messageTrend.timeRanges.1day"),value:86400},{label:this.t("charts.messageTrend.timeRanges.3days"),value:259200},{label:this.t("charts.messageTrend.timeRanges.1week"),value:604800},{label:this.t("charts.messageTrend.timeRanges.1month"),value:2592e3}],this.selectedTimeRange=this.timeRanges[0],this.chartOptions.tooltip.y.title.formatter=()=>this.t("charts.messageTrend.messageCount")+" ",this.chartOptions.xaxis.title.text=this.t("charts.messageTrend.timeLabel"),this.chartOptions.yaxis.title.text=this.t("charts.messageTrend.messageCount"),this.chartSeries[0].name=this.t("charts.messageTrend.messageCount"),this.fetchMessageSeries()},methods:{formatNumber(e){return new Intl.NumberFormat("zh-CN").format(e)},async fetchMessageSeries(){this.loading=!0;try{const r=(await R.get(`/api/stat/get?offset_sec=${this.selectedTimeRange.value}`)).data.data;r&&r.message_time_series&&(this.messageTimeSeries=r.message_time_series,this.processTimeSeriesData())}catch(e){console.error(this.t("status.dataError"),e)}finally{this.loading=!1}},processTimeSeriesData(){this.chartSeries[0].data=this.messageTimeSeries.map(r=>[new Date(r[0]*1e3).getTime(),r[1]]);let e=0;if(this.messageTimeSeries.forEach(r=>{e+=r[1]}),this.totalMessages=this.formatNumber(e),this.messageTimeSeries.length>0){const r=this.selectedTimeRange.value/86400;this.dailyAverage=this.formatNumber(Math.round(e/r))}this.calculateGrowthRate()},calculateGrowthRate(){if(this.messageTimeSeries.length<4){this.growthRate=0;return}const e=Math.floor(this.messageTimeSeries.length/2),r=this.messageTimeSeries.slice(0,e).reduce((i,n)=>i+n[1],0),l=this.messageTimeSeries.slice(e).reduce((i,n)=>i+n[1],0);r>0?this.growthRate=Math.round((l-r)/r*100):this.growthRate=l>0?100:0}}},Ot={class:"chart-header"},At={class:"chart-title"},Bt={class:"chart-subtitle"},Et={class:"d-flex align-center"},Ht={class:"chart-stats"},Ft={class:"stat-box"},jt={class:"stat-label"},Gt={class:"stat-number"},Jt={class:"stat-box"},Kt={class:"stat-label"},Qt={class:"stat-number"},Wt={class:"stat-label"},Yt={class:"stat-number"},qt={class:"chart-container"},Xt={key:0,class:"loading-overlay"},Zt={class:"loading-text"};function te(e,r,l,i,n,c){const _=g("apexchart");return m(),h(w,{elevation:"1",class:"chart-card"},{default:o(()=>[s(x,null,{default:o(()=>[t("div",Ot,[t("div",null,[t("div",At,a(i.t("charts.messageTrend.title")),1),t("div",Bt,a(i.t("charts.messageTrend.subtitle")),1)]),s(L,{color:"primary",variant:"outlined",density:"compact","hide-details":"",modelValue:n.selectedTimeRange,"onUpdate:modelValue":[r[0]||(r[0]=d=>n.selectedTimeRange=d),c.fetchMessageSeries],items:n.timeRanges,"item-title":"label","item-value":"value",class:"time-select","return-object":"","single-line":""},{selection:o(({item:d})=>[t("div",Et,[s(p,{start:"",size:"small"},{default:o(()=>[u("mdi-calendar-range")]),_:1}),u(" "+a(d.raw.label),1)])]),_:1},8,["modelValue","items","onUpdate:modelValue"])]),t("div",Ht,[t("div",Ft,[t("div",jt,a(i.t("charts.messageTrend.totalMessages")),1),t("div",Gt,a(n.totalMessages),1)]),t("div",Jt,[t("div",Kt,a(i.t("charts.messageTrend.dailyAverage")),1),t("div",Qt,a(n.dailyAverage),1)]),t("div",{class:k(["stat-box",{"trend-up":n.growthRate>0,"trend-down":n.growthRate<0}])},[t("div",Wt,a(i.t("charts.messageTrend.growthRate")),1),t("div",Yt,[N(s(p,{size:"small",icon:n.growthRate>0?"mdi-arrow-up":"mdi-arrow-down"},null,8,["icon"]),[[O,n.growthRate!==0]]),u(" "+a(Math.abs(n.growthRate))+"% ",1)])],2)]),t("div",qt,[n.loading?(m(),T("div",Xt,[s(A,{indeterminate:"",color:"primary"}),t("div",Zt,a(i.t("status.loading")),1)])):C("",!0),s(_,{type:"area",height:"280",options:n.chartOptions,series:n.chartSeries,ref:"chart"},null,8,["options","series"])])]),_:1})]),_:1})}const ee=y(Nt,[["render",te],["__scopeId","data-v-e98ede1b"]]);const se={name:"PlatformStat",props:["stat"],setup(){const{tm:e}=v("features/dashboard");return{t:e}},data(){return{platforms:[]}},computed:{sortedPlatforms(){return[...this.platforms].sort((e,r)=>r.count-e.count)},totalCount(){return this.platforms.reduce((e,r)=>e+r.count,0)},mostActivePlatform(){return this.sortedPlatforms.length>0?this.sortedPlatforms[0].name:"-"},topPlatformPercentage(){return this.totalCount===0||this.sortedPlatforms.length===0?0:Math.round(this.sortedPlatforms[0].count/this.totalCount*100)}},watch:{stat:{handler:function(e){e&&e.platform&&(this.platforms=e.platform)},deep:!0}},methods:{getPercentage(e){return this.totalCount?e/this.totalCount*100:0}}},ae={class:"platform-header"},oe={class:"platform-title"},re={class:"platform-subtitle"},ne={key:0,class:"platform-list-container"},ie={class:"platform-count"},le={class:"count-value"},ce={class:"count-label"},de={class:"platform-stats-summary"},me={class:"platform-stat-item"},_e={class:"stat-label"},he={class:"stat-value"},ue={class:"platform-stat-item"},fe={class:"stat-label"},ge={class:"stat-value"},pe={class:"platform-stat-item"},ve={class:"stat-label"},ye={class:"stat-value"},be={class:"platform-chart"},Te={key:1,class:"no-data"},xe={class:"no-data-text"};function we(e,r,l,i,n,c){return m(),h(w,{elevation:"1",class:"platform-stat-card"},{default:o(()=>[s(x,null,{default:o(()=>[t("div",ae,[t("div",null,[t("div",oe,a(i.t("charts.platformStat.title")),1),t("div",re,a(i.t("charts.platformStat.subtitle")),1)])]),s(S,{class:"my-3"}),n.platforms.length>0?(m(),T("div",ne,[s(B,{class:"platform-list",density:"compact"},{default:o(()=>[(m(!0),T(V,null,$(c.sortedPlatforms,(_,d)=>(m(),h(E,{key:d,value:_,class:"platform-item"},{prepend:o(()=>[t("div",{class:k(["platform-rank",{"top-rank":d<3}])},a(d+1),3)]),append:o(()=>[t("div",ie,[t("span",le,a(_.count),1),t("span",ce,a(i.t("charts.platformStat.messageUnit")),1)])]),default:o(()=>[s(H,{class:"platform-name"},{default:o(()=>[u(a(_.name),1)]),_:2},1024)]),_:2},1032,["value"]))),128))]),_:1}),t("div",de,[t("div",me,[t("div",_e,a(i.t("charts.platformStat.platformCount")),1),t("div",he,a(n.platforms.length),1)]),s(S,{vertical:""}),t("div",ue,[t("div",fe,a(i.t("charts.platformStat.mostActive")),1),t("div",ge,a(c.mostActivePlatform),1)]),s(S,{vertical:""}),t("div",pe,[t("div",ve,a(i.t("charts.platformStat.totalPercentage")),1),t("div",ye,a(c.topPlatformPercentage)+"%",1)])]),t("div",be,[(m(!0),T(V,null,$(c.sortedPlatforms.slice(0,5),(_,d)=>(m(),h(F,{key:d,"model-value":c.getPercentage(_.count),height:"8",rounded:"",class:"platform-progress",color:d===0?"primary":d===1?"info":d===2?"success":"grey-lighten-1"},null,8,["model-value","color"]))),128))])])):(m(),T("div",Te,[s(p,{icon:"mdi-information-outline",size:"40",color:"grey-lighten-1"}),t("div",xe,a(i.t("charts.platformStat.noData")),1)]))]),_:1})]),_:1})}const Se=y(se,[["render",we],["__scopeId","data-v-3303d358"]]);const Me={name:"DefaultDashboard",components:{TotalMessage:st,OnlinePlatform:_t,RunningTime:xt,MemoryUsage:Lt,MessageStat:ee,PlatformStat:Se},setup(){const{tm:e}=v("features/dashboard");return{t:e}},data(){return{stat:{},noticeTitle:"",noticeContent:"",noticeType:"",lastUpdated:"",refreshInterval:null,isRefreshing:!1}},mounted(){this.lastUpdated=this.t("status.loading"),this.fetchData(),this.fetchNotice(),this.refreshInterval=setInterval(()=>{this.fetchData()},6e4)},beforeUnmount(){this.refreshInterval&&clearInterval(this.refreshInterval)},methods:{async fetchData(){this.isRefreshing=!0;try{const e=await R.get("/api/stat/get");this.stat=e.data.data,this.lastUpdated=new Date().toLocaleTimeString(),console.log("Dashboard data:",this.stat)}catch(e){console.error(this.t("status.dataError"),e)}finally{this.isRefreshing=!1}},fetchNotice(){R.get("https://api.soulter.top/astrbot-announcement").then(e=>{let r=e.data.data;r["dashboard-notice"]&&(this.noticeTitle=r["dashboard-notice"].title,this.noticeContent=r["dashboard-notice"].content,this.noticeType=r["dashboard-notice"].type)}).catch(e=>{console.error(this.t("status.noticeError"),e)})}}},Re={class:"dashboard-container"},Pe={class:"dashboard-footer"};function Ce(e,r,l,i,n,c){const _=g("TotalMessage"),d=g("OnlinePlatform"),D=g("RunningTime"),z=g("MemoryUsage"),U=g("MessageStat"),I=g("PlatformStat");return m(),T("div",Re,[s(f,null,{default:o(()=>[n.noticeTitle&&n.noticeContent?(m(),h(M,{key:0,class:"notice-row"},{default:o(()=>[s(G,{type:n.noticeType,text:n.noticeContent,title:n.noticeTitle,closable:"",class:"dashboard-alert",variant:"tonal",border:"start"},null,8,["type","text","title"])]),_:1})):C("",!0)]),_:1}),s(M,{class:"stats-row"},{default:o(()=>[s(b,{cols:"12",md:"3"},{default:o(()=>[s(f,null,{default:o(()=>[s(_,{stat:n.stat},null,8,["stat"])]),_:1})]),_:1}),s(b,{cols:"12",md:"3"},{default:o(()=>[s(f,null,{default:o(()=>[s(d,{stat:n.stat},null,8,["stat"])]),_:1})]),_:1}),s(b,{cols:"12",md:"3"},{default:o(()=>[s(f,null,{default:o(()=>[s(D,{stat:n.stat},null,8,["stat"])]),_:1})]),_:1}),s(b,{cols:"12",md:"3"},{default:o(()=>[s(f,null,{default:o(()=>[s(z,{stat:n.stat},null,8,["stat"])]),_:1})]),_:1})]),_:1}),s(M,{class:"charts-row"},{default:o(()=>[s(b,{cols:"12",lg:"8"},{default:o(()=>[s(f,null,{default:o(()=>[s(U)]),_:1})]),_:1}),s(b,{cols:"12",lg:"4"},{default:o(()=>[s(f,null,{default:o(()=>[s(I,{stat:n.stat},null,8,["stat"])]),_:1})]),_:1})]),_:1}),t("div",Pe,[s(P,{size:"small",color:"primary",variant:"flat","prepend-icon":"mdi-refresh"},{default:o(()=>[u(a(i.t("lastUpdate"))+": "+a(n.lastUpdated),1)]),_:1}),s(j,{icon:"mdi-refresh",size:"small",color:"primary",variant:"text",class:"ml-2",onClick:c.fetchData,loading:n.isRefreshing},null,8,["onClick","loading"])])])}const De=y(Me,[["render",Ce],["__scopeId","data-v-850bf7cb"]]);export{De as default};
