import{u as H,a5 as A,_ as y,a6 as T,k as v,b as i,w as a,I as P,X as I,ag as U,o as h,D as b,E as C,l as m,t as r,V as f,d as c,aa as B,ab as D,aA as j,a7 as z,T as F,p as g,c as w,f as x,U as M,H as V,R as O,e as u,aL as L,B as k,W as E,Y as N,F as J,n as G,Q as R}from"./index-427e6df5.js";import{l as W}from"./lodash-a7005334.js";import{V as Q}from"./index-c4200cc5.js";import{M as X}from"./index-47e3efb7.js";import{u as Y}from"./common-74ca9dd8.js";import{M as q}from"./MessageList-54c4e872.js";import{_ as K}from"./_plugin-vue_export-helper-c27b6911.js";import"./github-aa66a161.js";new X({html:!1,breaks:!0,linkify:!0,typographer:!1});const Z={name:"ConversationPage",components:{VueMonacoEditor:Q,MessageList:q},setup(){const{t,locale:s}=H(),{tm:n}=A("features/conversation");return{t,tm:n,locale:s}},data(){return{conversations:[],search:"",headers:[],selectedItems:[],platformFilter:[],messageTypeFilter:[],lastAppliedFilters:null,pagination:{page:1,page_size:20,total:0,total_pages:0},pageSizeOptions:[10,20,50,100],dialogView:!1,dialogEdit:!1,dialogDelete:!1,dialogBatchDelete:!1,selectedConversation:null,conversationHistory:[],editedItem:{user_id:"",cid:"",title:""},valid:!0,loading:!1,showMessage:!1,message:"",messageType:"success",isEditingHistory:!1,editedHistory:"",savingHistory:!1,monacoEditor:null,commonStore:Y()}},watch:{platformFilter(){this.debouncedApplyFilters()},messageTypeFilter(){this.debouncedApplyFilters()},search(){this.debouncedApplyFilters()}},created(){this.debouncedApplyFilters=W.debounce(()=>{this.pagination.page=1,this.fetchConversations()},300)},computed:{tableHeaders(){return[{title:this.tm("table.headers.title"),key:"title",sortable:!0},{title:"会话 ID",key:"cid",sortable:!0,width:"100px"},{title:this.tm("table.headers.sessionId"),align:"center",children:[{title:this.tm("table.headers.platform"),key:"platform",sortable:!0,width:"120px"},{title:this.tm("table.headers.type"),key:"messageType",sortable:!0,width:"100px"},{title:"用户 ID",key:"sessionId",sortable:!0,width:"100px"}]},{title:this.tm("table.headers.createdAt"),key:"created_at",sortable:!0,width:"180px"},{title:this.tm("table.headers.updatedAt"),key:"updated_at",sortable:!0,width:"180px"},{title:this.tm("table.headers.actions"),key:"actions",sortable:!1,align:"center"}]},availablePlatforms(){const t=[],s=this.commonStore.tutorial_map;for(const n in s)s.hasOwnProperty(n)&&t.push({title:n,value:n});return t},messageTypeItems(){return[{title:this.tm("messageTypes.group"),value:"GroupMessage"},{title:this.tm("messageTypes.friend"),value:"FriendMessage"}]},currentFilters(){return{platforms:this.platformFilter.map(s=>typeof s=="object"?s.value:s),messageTypes:this.messageTypeFilter,search:this.search}},formattedMessages(){return this.conversationHistory.map(t=>(console.log("处理消息:",t.role,t.image_url,t.audio_url),t.role==="user"?{content:{type:"user",message:this.extractTextFromContent(t.content),image_url:this.extractImagesFromContent(t.content)}}:{content:{type:"bot",message:this.extractTextFromContent(t.content),embedded_images:this.extractImagesFromContent(t.content)}}))}},mounted(){this.fetchConversations()},methods:{onMonacoMounted(t){this.monacoEditor=t,t.onDidChangeModelContent(()=>{try{JSON.parse(this.editedHistory),t.getAction("editor.action.formatDocument").run()}catch{}})},handleTableOptions(t){t.itemsPerPage!==this.pagination.page_size&&(this.pagination.page_size=t.itemsPerPage,this.pagination.page=1,this.fetchConversations())},parseSessionId(t){if(!t)return{platform:"default",messageType:"default",sessionId:""};const s=t.split(":");return s.length>=3?{platform:s[0]||"default",messageType:s[1]||"default",sessionId:s.slice(2).join(":")}:{platform:"default",messageType:"default",sessionId:t}},getMessageTypeDisplay(t){const s={GroupMessage:this.tm("messageTypes.group"),FriendMessage:this.tm("messageTypes.friend"),default:this.tm("messageTypes.unknown")};return s[t]||s.default},fetchConversations:(()=>{let t=new AbortController;return async function(){var s,n;t==null||t.abort(),t=new AbortController,this.loading=!0;try{const l={page:this.pagination.page,page_size:this.pagination.page_size};if(this.platformFilter.length>0){const d=this.platformFilter.map(p=>typeof p=="object"?p.value:p);l.platforms=d.join(",")}this.messageTypeFilter.length>0&&(l.message_types=this.messageTypeFilter.join(",")),this.search&&(l.search=this.search.trim()),l.exclude_ids="astrbot",l.exclude_platforms="webchat";const e=await y.get("/api/conversation/list",{signal:t.signal,params:l});if(this.lastAppliedFilters={...this.currentFilters},e.data.status==="ok"){const d=e.data.data;if(!d||!d.conversations){console.error("API 返回数据格式不符合预期:",d),this.showErrorMessage(this.tm("messages.fetchError"));return}this.conversations=(d.conversations||[]).map(p=>(p.sessionInfo=this.parseSessionId(p.user_id),p)),d.pagination?this.pagination={page:d.pagination.page||1,page_size:d.pagination.page_size||20,total:d.pagination.total||0,total_pages:d.pagination.total_pages||1}:console.warn("API 响应中没有分页信息")}else this.showErrorMessage(e.data.message||this.tm("messages.fetchError"))}catch(l){if(y.isCancel(l))return;console.error("获取对话列表出错:",l),l.response&&(console.error("错误响应数据:",l.response.data),console.error("错误状态码:",l.response.status)),this.showErrorMessage(((n=(s=l.response)==null?void 0:s.data)==null?void 0:n.message)||l.message||this.tm("messages.fetchError"))}finally{this.loading=!1}}})(),async viewConversation(t){var s,n;this.selectedConversation=t,this.loading=!0,this.isEditingHistory=!1;try{console.log(`正在请求对话详情，user_id=${t.user_id}, cid=${t.cid}`);const l=await y.post("/api/conversation/detail",{user_id:t.user_id,cid:t.cid});if(l.data.status==="ok"){try{const e=l.data.data.history||"[]";this.conversationHistory=JSON.parse(e),this.editedHistory=JSON.stringify(this.conversationHistory,null,2)}catch(e){this.conversationHistory=[],this.editedHistory="[]",console.error("解析对话历史失败:",e)}this.dialogView=!0}else this.showErrorMessage(l.data.message||this.tm("messages.historyError"))}catch(l){console.error("获取对话详情出错:",l),this.showErrorMessage(((n=(s=l.response)==null?void 0:s.data)==null?void 0:n.message)||l.message||this.tm("messages.historyError"))}finally{this.loading=!1}},async saveHistoryChanges(){var t,s;if(this.selectedConversation){this.savingHistory=!0;try{let n;try{n=JSON.parse(this.editedHistory)}catch{this.showErrorMessage(this.tm("messages.invalidJson"));return}const l=await y.post("/api/conversation/update_history",{user_id:this.selectedConversation.user_id,cid:this.selectedConversation.cid,history:n});l.data.status==="ok"?(this.conversationHistory=n,this.showSuccessMessage(this.tm("messages.historySaveSuccess")),this.isEditingHistory=!1):this.showErrorMessage(l.data.message||this.tm("messages.historySaveError"))}catch(n){console.error("更新对话历史出错:",n),this.showErrorMessage(((s=(t=n.response)==null?void 0:t.data)==null?void 0:s.message)||n.message||this.tm("messages.historySaveError"))}finally{this.savingHistory=!1}}},closeHistoryDialog(){this.isEditingHistory?confirm(this.tm("dialogs.view.confirmClose"))&&(this.dialogView=!1):this.dialogView=!1},editConversation(t){this.selectedConversation=t,this.editedItem=Object.assign({},t),this.dialogEdit=!0},async saveConversation(){var t,s;if(this.$refs.form.validate()){this.loading=!0;try{const n=await y.post("/api/conversation/update",{user_id:this.editedItem.user_id,cid:this.editedItem.cid,title:this.editedItem.title});if(n.data.status==="ok"){const l=this.conversations.findIndex(e=>e.user_id===this.editedItem.user_id&&e.cid===this.editedItem.cid);l!==-1&&(this.conversations[l].title=this.editedItem.title),this.dialogEdit=!1,this.showSuccessMessage(this.tm("messages.saveSuccess")),this.fetchConversations()}else this.showErrorMessage(n.data.message||this.tm("messages.saveError"))}catch(n){this.showErrorMessage(((s=(t=n.response)==null?void 0:t.data)==null?void 0:s.message)||n.message||this.tm("messages.saveError"))}finally{this.loading=!1}}},confirmDeleteConversation(t){this.selectedConversation=t,this.dialogDelete=!0},async deleteConversation(){var t,s;this.loading=!0;try{const n=await y.post("/api/conversation/delete",{user_id:this.selectedConversation.user_id,cid:this.selectedConversation.cid});if(n.data.status==="ok"){const l=this.conversations.findIndex(e=>e.user_id===this.selectedConversation.user_id&&e.cid===this.selectedConversation.cid);l!==-1&&this.conversations.splice(l,1),this.dialogDelete=!1,this.showSuccessMessage(this.tm("messages.deleteSuccess"))}else this.showErrorMessage(n.data.message||this.tm("messages.deleteError"))}catch(n){this.showErrorMessage(((s=(t=n.response)==null?void 0:t.data)==null?void 0:s.message)||n.message||this.tm("messages.deleteError"))}finally{this.loading=!1,this.selectedItems=this.selectedItems.filter(n=>!(n.user_id===this.selectedConversation.user_id&&n.cid===this.selectedConversation.cid)),this.selectedConversation=null}},onPageSizeChange(){this.pagination.page=1,this.fetchConversations()},confirmBatchDelete(){if(this.selectedItems.length===0){this.showErrorMessage(this.tm("messages.noItemSelected"));return}this.dialogBatchDelete=!0},removeFromSelection(t){const s=this.selectedItems.findIndex(n=>n.user_id===t.user_id&&n.cid===t.cid);s!==-1&&this.selectedItems.splice(s,1)},async batchDeleteConversations(){var t,s;if(this.selectedItems.length===0){this.showErrorMessage(this.tm("messages.noItemSelected"));return}this.loading=!0;try{const n=this.selectedItems.map(e=>({user_id:e.user_id,cid:e.cid})),l=await y.post("/api/conversation/delete",{conversations:n});if(l.data.status==="ok"){const e=l.data.data;this.dialogBatchDelete=!1,this.selectedItems=[],e.failed_count>0?this.showErrorMessage(this.tm("messages.batchDeletePartial",{deleted:e.deleted_count,failed:e.failed_count})):this.showSuccessMessage(this.tm("messages.batchDeleteSuccess",{count:e.deleted_count})),this.fetchConversations()}else this.showErrorMessage(l.data.message||this.tm("messages.batchDeleteError"))}catch(n){console.error("批量删除对话出错:",n),this.showErrorMessage(((s=(t=n.response)==null?void 0:t.data)==null?void 0:s.message)||n.message||this.tm("messages.batchDeleteError"))}finally{this.loading=!1}},formatTimestamp(t){if(!t)return this.tm("status.unknown");const s=new Date(t*1e3),n=this.locale||"zh-CN";return new Intl.DateTimeFormat(n,{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1}).format(s)},showSuccessMessage(t){this.message=t,this.messageType="success",this.showMessage=!0},showErrorMessage(t){this.message=t,this.messageType="error",this.showMessage=!0},extractTextFromContent(t){return typeof t=="string"?t:Array.isArray(t)?t.filter(s=>s.type==="text").map(s=>s.text).join(`
`):typeof t=="object"?Object.values(t).filter(s=>typeof s=="string").join(""):""},extractImagesFromContent(t){return Array.isArray(t)?t.filter(s=>s.type==="image_url").map(s=>{var n;return(n=s.image_url)==null?void 0:n.url}).filter(s=>s):[]}}},$={class:"conversation-page"},ee={class:"text-h4"},se={class:"d-flex align-center"},te={class:"text-truncate"},ie={class:"actions-wrapper"},ae={class:"d-flex flex-column align-center py-6"},le={class:"text-subtitle-1 text-disabled mt-3"},oe={class:"d-flex justify-center py-3"},ne={class:"d-flex justify-between align-center px-4 py-2 bg-grey-lighten-5"},re={class:"d-flex align-center"},de={class:"text-caption mr-2"},ce={class:"text-caption ml-4"},me={class:"text-truncate"},ge={key:0,class:"d-flex align-center"},he={class:"mb-4 d-flex align-center"},ue={key:0,class:"monaco-editor-container"},pe={key:1,class:"conversation-messages-container"},fe={key:0,class:"text-center py-5"},ye={class:"text-disabled mt-2"},ve={class:"mb-3"},_e={key:0,class:"mb-3"};function be(t,s,n,l,e,d){const p=T("VueMonacoEditor"),S=T("MessageList");return h(),v("div",$,[i(P,{fluid:"",class:"pa-0"},{default:a(()=>[i(b,{flat:""},{default:a(()=>[i(C,{class:"d-flex align-center py-3 px-4"},{default:a(()=>[m("span",ee,r(l.tm("history.title")),1),i(f,{size:"small",class:"ml-2"},{default:a(()=>[c(r(e.pagination.total||0),1)]),_:1}),i(B,{class:"me-4 ms-4",dense:""},{default:a(()=>[i(D,{cols:"12",sm:"6",md:"4"},{default:a(()=>[i(j,{modelValue:e.platformFilter,"onUpdate:modelValue":s[0]||(s[0]=o=>e.platformFilter=o),label:l.tm("filters.platform"),items:d.availablePlatforms,chips:"",multiple:"",clearable:"",variant:"solo-filled",flat:"",density:"compact","hide-details":""},{selection:a(({item:o})=>[i(f,{size:"small",label:""},{default:a(()=>[c(r(o.title),1)]),_:2},1024)]),_:1},8,["modelValue","label","items"])]),_:1}),i(D,{cols:"12",sm:"6",md:"4"},{default:a(()=>[i(z,{modelValue:e.messageTypeFilter,"onUpdate:modelValue":s[1]||(s[1]=o=>e.messageTypeFilter=o),label:l.tm("filters.type"),items:d.messageTypeItems,chips:"",multiple:"",clearable:"",variant:"solo-filled",density:"compact","hide-details":"",flat:""},{selection:a(({item:o})=>[i(f,{size:"small",variant:"solo-filled",label:""},{default:a(()=>[c(r(o.title),1)]),_:2},1024)]),_:1},8,["modelValue","label","items"])]),_:1}),i(D,{cols:"12",sm:"12",md:"4"},{default:a(()=>[i(F,{modelValue:e.search,"onUpdate:modelValue":s[2]||(s[2]=o=>e.search=o),"prepend-inner-icon":"mdi-magnify",label:l.tm("filters.search"),"hide-details":"",density:"compact",variant:"solo-filled",flat:"",clearable:""},null,8,["modelValue","label"])]),_:1})]),_:1}),i(g,{color:"primary","prepend-icon":"mdi-refresh",variant:"tonal",onClick:d.fetchConversations,loading:e.loading,size:"small",class:"mr-2"},{default:a(()=>[c(r(l.tm("history.refresh")),1)]),_:1},8,["onClick","loading"]),e.selectedItems.length>0?(h(),w(g,{key:0,color:"error","prepend-icon":"mdi-delete",variant:"tonal",onClick:d.confirmBatchDelete,disabled:e.loading,size:"small"},{default:a(()=>[c(r(l.tm("batch.deleteSelected",{count:e.selectedItems.length})),1)]),_:1},8,["onClick","disabled"])):x("",!0)]),_:1}),i(M),i(V,{class:"pa-0"},{default:a(()=>[i(O,{modelValue:e.selectedItems,"onUpdate:modelValue":s[3]||(s[3]=o=>e.selectedItems=o),headers:d.tableHeaders,items:e.conversations,loading:e.loading,style:{"font-size":"12px"},density:"comfortable","hide-default-footer":"",class:"elevation-0","items-per-page":e.pagination.page_size,"items-per-page-options":e.pageSizeOptions,"show-select":"","return-object":"",disabled:e.loading,"onUpdate:options":d.handleTableOptions},{"item.title":a(({item:o})=>[m("div",se,[m("span",null,r(o.title||l.tm("status.noTitle")),1)])]),"item.platform":a(({item:o})=>[i(f,{size:"small",label:""},{default:a(()=>[c(r(o.sessionInfo.platform||l.tm("status.unknown")),1)]),_:2},1024)]),"item.messageType":a(({item:o})=>[i(f,{size:"small",label:""},{default:a(()=>[c(r(d.getMessageTypeDisplay(o.sessionInfo.messageType)),1)]),_:2},1024)]),"item.cid":a(({item:o})=>[m("span",te,r(o.cid||l.tm("status.unknown")),1)]),"item.sessionId":a(({item:o})=>[m("span",null,r(o.sessionInfo.sessionId||l.tm("status.unknown")),1)]),"item.created_at":a(({item:o})=>[c(r(d.formatTimestamp(o.created_at)),1)]),"item.updated_at":a(({item:o})=>[c(r(d.formatTimestamp(o.updated_at)),1)]),"item.actions":a(({item:o})=>[m("div",ie,[i(g,{icon:"",variant:"plain",size:"x-small",class:"action-button",onClick:_=>d.viewConversation(o),disabled:e.loading},{default:a(()=>[i(u,null,{default:a(()=>[c("mdi-eye")]),_:1})]),_:2},1032,["onClick","disabled"]),i(g,{icon:"",variant:"plain",size:"x-small",class:"action-button",onClick:_=>d.editConversation(o),disabled:e.loading},{default:a(()=>[i(u,null,{default:a(()=>[c("mdi-pencil")]),_:1})]),_:2},1032,["onClick","disabled"]),i(g,{icon:"",color:"error",variant:"plain",size:"x-small",class:"action-button",onClick:_=>d.confirmDeleteConversation(o),disabled:e.loading},{default:a(()=>[i(u,null,{default:a(()=>[c("mdi-delete")]),_:1})]),_:2},1032,["onClick","disabled"])])]),"no-data":a(()=>[m("div",ae,[i(u,{size:"64",color:"grey lighten-1"},{default:a(()=>[c("mdi-chat-remove")]),_:1}),m("span",le,r(l.tm("status.noData")),1)])]),_:1},8,["modelValue","headers","items","loading","items-per-page","items-per-page-options","disabled","onUpdate:options"]),m("div",oe,[m("div",ne,[m("div",re,[m("span",de,r(l.tm("pagination.itemsPerPage"))+":",1),i(z,{modelValue:e.pagination.page_size,"onUpdate:modelValue":[s[4]||(s[4]=o=>e.pagination.page_size=o),d.onPageSizeChange],items:e.pageSizeOptions,variant:"outlined",density:"compact","hide-details":"",style:{"max-width":"100px"},disabled:e.loading},null,8,["modelValue","items","disabled","onUpdate:modelValue"])]),m("div",ce,r(l.tm("pagination.showingItems",{start:Math.min((e.pagination.page-1)*e.pagination.page_size+1,e.pagination.total),end:Math.min(e.pagination.page*e.pagination.page_size,e.pagination.total),total:e.pagination.total})),1)]),i(L,{modelValue:e.pagination.page,"onUpdate:modelValue":[s[5]||(s[5]=o=>e.pagination.page=o),d.fetchConversations],length:e.pagination.total_pages,disabled:e.loading,rounded:"circle","total-visible":7},null,8,["modelValue","length","disabled","onUpdate:modelValue"])])]),_:1})]),_:1})]),_:1}),i(I,{modelValue:e.dialogView,"onUpdate:modelValue":s[8]||(s[8]=o=>e.dialogView=o),"max-width":"900px",scrollable:""},{default:a(()=>[i(b,{class:"conversation-detail-card"},{default:a(()=>[i(C,{class:"ml-2 mt-2 d-flex align-center"},{default:a(()=>{var o,_;return[m("span",me,r(((o=e.selectedConversation)==null?void 0:o.title)||l.tm("status.noTitle")),1),i(k),(_=e.selectedConversation)!=null&&_.sessionInfo?(h(),v("div",ge,[i(f,{"text-color":"primary",size:"small",class:"mr-2",rounded:"md"},{default:a(()=>[c(r(e.selectedConversation.sessionInfo.platform),1)]),_:1}),i(f,{"text-color":"secondary",size:"small",rounded:"md"},{default:a(()=>[c(r(d.getMessageTypeDisplay(e.selectedConversation.sessionInfo.messageType)),1)]),_:1})])):x("",!0)]}),_:1}),i(V,null,{default:a(()=>[m("div",he,[i(g,{color:"secondary",variant:"tonal",size:"small",class:"mr-2",onClick:s[6]||(s[6]=o=>e.isEditingHistory=!e.isEditingHistory)},{default:a(()=>[i(u,{class:"mr-1"},{default:a(()=>[c(r(e.isEditingHistory?"mdi-eye":"mdi-pencil"),1)]),_:1}),c(" "+r(e.isEditingHistory?l.tm("dialogs.view.previewMode"):l.tm("dialogs.view.editMode")),1)]),_:1}),e.isEditingHistory?(h(),w(g,{key:0,color:"success",variant:"tonal",size:"small",loading:e.savingHistory,onClick:d.saveHistoryChanges},{default:a(()=>[i(u,{class:"mr-1"},{default:a(()=>[c("mdi-content-save")]),_:1}),c(" "+r(l.tm("dialogs.view.saveChanges")),1)]),_:1},8,["loading","onClick"])):x("",!0)]),e.isEditingHistory?(h(),v("div",ue,[i(p,{value:e.editedHistory,"onUpdate:value":s[7]||(s[7]=o=>e.editedHistory=o),theme:"vs-dark",language:"json",options:{automaticLayout:!0,fontSize:13,tabSize:2,minimap:{enabled:!1},scrollBeyondLastLine:!1,wordWrap:"on"},onEditorDidMount:d.onMonacoMounted},null,8,["value","onEditorDidMount"])])):(h(),v("div",pe,[e.conversationHistory.length===0?(h(),v("div",fe,[i(u,{size:"48",color:"grey"},{default:a(()=>[c("mdi-chat-remove")]),_:1}),m("p",ye,r(l.tm("status.emptyContent")),1)])):(h(),w(S,{key:1,messages:d.formattedMessages,isDark:!1},null,8,["messages"]))]))]),_:1}),i(E,{class:"pa-4"},{default:a(()=>[i(k),i(g,{variant:"text",onClick:d.closeHistoryDialog},{default:a(()=>[c(r(l.tm("dialogs.view.close")),1)]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),i(I,{modelValue:e.dialogEdit,"onUpdate:modelValue":s[12]||(s[12]=o=>e.dialogEdit=o),"max-width":"500px"},{default:a(()=>[i(b,null,{default:a(()=>[i(C,{class:"bg-primary text-white py-3"},{default:a(()=>[i(u,{color:"white",class:"me-2"},{default:a(()=>[c("mdi-pencil")]),_:1}),m("span",null,r(l.tm("dialogs.edit.title")),1)]),_:1}),i(V,{class:"py-4"},{default:a(()=>[i(N,{ref:"form",modelValue:e.valid,"onUpdate:modelValue":s[10]||(s[10]=o=>e.valid=o)},{default:a(()=>[i(F,{modelValue:e.editedItem.title,"onUpdate:modelValue":s[9]||(s[9]=o=>e.editedItem.title=o),label:l.tm("dialogs.edit.titleLabel"),placeholder:l.tm("dialogs.edit.titlePlaceholder"),variant:"outlined",density:"comfortable",class:"mb-3"},null,8,["modelValue","label","placeholder"])]),_:1},8,["modelValue"])]),_:1}),i(M),i(E,{class:"pa-4"},{default:a(()=>[i(k),i(g,{variant:"text",onClick:s[11]||(s[11]=o=>e.dialogEdit=!1),disabled:e.loading},{default:a(()=>[c(r(l.tm("dialogs.edit.cancel")),1)]),_:1},8,["disabled"]),i(g,{color:"primary",onClick:d.saveConversation,loading:e.loading},{default:a(()=>[c(r(l.tm("dialogs.edit.save")),1)]),_:1},8,["onClick","loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),i(I,{modelValue:e.dialogDelete,"onUpdate:modelValue":s[14]||(s[14]=o=>e.dialogDelete=o),"max-width":"500px"},{default:a(()=>[i(b,null,{default:a(()=>[i(C,{class:"bg-error text-white py-3"},{default:a(()=>[i(u,{color:"white",class:"me-2"},{default:a(()=>[c("mdi-alert")]),_:1}),m("span",null,r(l.tm("dialogs.delete.title")),1)]),_:1}),i(V,{class:"py-4"},{default:a(()=>{var o;return[m("p",null,r(l.tm("dialogs.delete.message",{title:((o=e.selectedConversation)==null?void 0:o.title)||l.tm("status.noTitle")})),1)]}),_:1}),i(M),i(E,{class:"pa-4"},{default:a(()=>[i(k),i(g,{variant:"text",onClick:s[13]||(s[13]=o=>e.dialogDelete=!1),disabled:e.loading},{default:a(()=>[c(r(l.tm("dialogs.delete.cancel")),1)]),_:1},8,["disabled"]),i(g,{color:"error",onClick:d.deleteConversation,loading:e.loading},{default:a(()=>[c(r(l.tm("dialogs.delete.confirm")),1)]),_:1},8,["onClick","loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),i(I,{modelValue:e.dialogBatchDelete,"onUpdate:modelValue":s[16]||(s[16]=o=>e.dialogBatchDelete=o),"max-width":"600px"},{default:a(()=>[i(b,null,{default:a(()=>[i(C,{class:"bg-error text-white py-3"},{default:a(()=>[i(u,{color:"white",class:"me-2"},{default:a(()=>[c("mdi-delete")]),_:1}),m("span",null,r(l.tm("dialogs.batchDelete.title")),1)]),_:1}),i(V,{class:"py-4"},{default:a(()=>[m("p",ve,r(l.tm("dialogs.batchDelete.message",{count:e.selectedItems.length})),1),e.selectedItems.length>0?(h(),v("div",_e,[(h(!0),v(J,null,G(e.selectedItems.slice(0,5),(o,_)=>(h(),w(f,{key:`${o.user_id}-${o.cid}`,size:"small",class:"mr-1 mb-1",closable:"","onClick:close":Ce=>d.removeFromSelection(o),disabled:e.loading},{default:a(()=>[c(r(o.title||l.tm("status.noTitle")),1)]),_:2},1032,["onClick:close","disabled"]))),128)),e.selectedItems.length>5?(h(),w(f,{key:0,size:"small",class:"mr-1 mb-1"},{default:a(()=>[c(r(l.tm("dialogs.batchDelete.andMore",{count:e.selectedItems.length-5})),1)]),_:1})):x("",!0)])):x("",!0),i(R,{type:"warning",variant:"tonal",class:"mb-3"},{default:a(()=>[c(r(l.tm("dialogs.batchDelete.warning")),1)]),_:1})]),_:1}),i(M),i(E,{class:"pa-4"},{default:a(()=>[i(k),i(g,{variant:"text",onClick:s[15]||(s[15]=o=>e.dialogBatchDelete=!1),disabled:e.loading},{default:a(()=>[c(r(l.tm("dialogs.batchDelete.cancel")),1)]),_:1},8,["disabled"]),i(g,{color:"error",onClick:d.batchDeleteConversations,loading:e.loading},{default:a(()=>[c(r(l.tm("dialogs.batchDelete.confirm")),1)]),_:1},8,["onClick","loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),i(U,{timeout:3e3,elevation:"24",color:e.messageType,modelValue:e.showMessage,"onUpdate:modelValue":s[17]||(s[17]=o=>e.showMessage=o),location:"top"},{default:a(()=>[c(r(e.message),1)]),_:1},8,["color","modelValue"])])}const Te=K(Z,[["render",be]]);export{Te as default};
